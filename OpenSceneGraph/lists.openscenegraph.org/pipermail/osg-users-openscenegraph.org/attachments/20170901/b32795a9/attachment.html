<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;Romulo,&lt;br&gt;&lt;br&gt;&lt;/div&gt;There&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;code&nbsp;in&nbsp;there&nbsp;which&nbsp;I&nbsp;wouldn&#39;t&nbsp;expect&nbsp;to&nbsp;affect&nbsp;the&nbsp;modelview&nbsp;and&nbsp;project&nbsp;matrices,&nbsp;my&nbsp;recommendation&nbsp;would&nbsp;be&nbsp;to&nbsp;create&nbsp;a&nbsp;small&nbsp;test&nbsp;example&nbsp;to&nbsp;test&nbsp;loading&nbsp;your&nbsp;data&nbsp;and&nbsp;setting&nbsp;your&nbsp;view&nbsp;and&nbsp;projection&nbsp;matrices&nbsp;as&nbsp;required&nbsp;without&nbsp;any&nbsp;of&nbsp;the&nbsp;frame&nbsp;capture&nbsp;code&nbsp;that&nbsp;will&nbsp;be&nbsp;getting&nbsp;in&nbsp;the&nbsp;way&nbsp;of&nbsp;working&nbsp;out&nbsp;what&nbsp;might&nbsp;be&nbsp;amiss.&lt;br&gt;&lt;br&gt;&lt;/div&gt;You&nbsp;code&nbsp;also&nbsp;nothing&nbsp;about&nbsp;your&nbsp;scene&nbsp;graph,&nbsp;as&nbsp;this&nbsp;might&nbsp;well&nbsp;be&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;issue&nbsp;there&nbsp;isn&#39;t&nbsp;much&nbsp;more&nbsp;we&nbsp;can&nbsp;guess&nbsp;at.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;best&nbsp;thing&nbsp;you&nbsp;can&nbsp;do&nbsp;at&nbsp;this&nbsp;point&nbsp;is&nbsp;go&nbsp;test&nbsp;your&nbsp;models&nbsp;against&nbsp;a&nbsp;standard&nbsp;example&nbsp;like&nbsp;osgviewer. &nbsp;If&nbsp;the&nbsp;error&nbsp;occurs&nbsp;there&nbsp;then&nbsp;posting&nbsp;this&nbsp;so&nbsp;others&nbsp;can&nbsp;try&nbsp;and&nbsp;reproduce&nbsp;the&nbsp;problem.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Robert.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;1&nbsp;September&nbsp;2017&nbsp;at&nbsp;16:10,&nbsp;Rômulo&nbsp;Cerqueira&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:romulogcerqueira@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;romulogcerqueira@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Ok&nbsp;Robert,&lt;br&gt;<br>
&lt;br&gt;<br>
this&nbsp;is&nbsp;my&nbsp;current&nbsp;code&nbsp;(only&nbsp;.cpp):&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Code:&lt;br&gt;<br>
&lt;br&gt;<br>
#include&nbsp;&quot;ImageViewerCaptureTool.hpp&quot;&lt;br&gt;<br>
#include&nbsp;&lt;iostream&gt;&lt;br&gt;<br>
#include&nbsp;&lt;unistd.h&gt;&lt;br&gt;<br>
#include&nbsp;&lt;osgDB/WriteFile&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
namespace&nbsp;normal_depth_map&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
ImageViewerCaptureTool::&lt;wbr&gt;ImageViewerCaptureTool(uint&nbsp;width,&nbsp;uint&nbsp;height)&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
//&nbsp;initialize&nbsp;the&nbsp;hide&nbsp;viewer;&lt;br&gt;<br>
initializeProperties(width,&nbsp;height);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
ImageViewerCaptureTool::&lt;wbr&gt;ImageViewerCaptureTool(&nbsp;double&nbsp;fovY,&nbsp;double&nbsp;fovX,&nbsp;uint&nbsp;value,&nbsp;bool&nbsp;isHeight)&nbsp;{&lt;br&gt;<br>
uint&nbsp;width,&nbsp;height;&lt;br&gt;<br>
&lt;br&gt;<br>
if&nbsp;(isHeight)&nbsp;{&lt;br&gt;<br>
height&nbsp;=&nbsp;value;&lt;br&gt;<br>
width&nbsp;=&nbsp;height&nbsp;*&nbsp;tan(fovX&nbsp;*&nbsp;0.5)&nbsp;/&nbsp;tan(fovY&nbsp;*&nbsp;0.5);&lt;br&gt;<br>
}&nbsp;else&nbsp;{&lt;br&gt;<br>
width&nbsp;=&nbsp;value;&lt;br&gt;<br>
height&nbsp;=&nbsp;width&nbsp;*&nbsp;tan(fovY&nbsp;*&nbsp;0.5)&nbsp;/&nbsp;tan(fovX&nbsp;*&nbsp;0.5);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
double&nbsp;aspectRatio&nbsp;=&nbsp;width&nbsp;*&nbsp;1.0&nbsp;/&nbsp;height;&lt;br&gt;<br>
&lt;br&gt;<br>
initializeProperties(width,&nbsp;height);&lt;br&gt;<br>
_viewer-&gt;getCamera()-&gt;&lt;wbr&gt;setComputeNearFarMode(osg::&lt;wbr&gt;CullSettings::DO_NOT_COMPUTE_&lt;wbr&gt;NEAR_FAR);&lt;br&gt;<br>
&lt;br&gt;<br>
_viewer-&gt;getCamera()-&gt;&lt;wbr&gt;setProjectionMatrixAsPerspecti&lt;wbr&gt;ve(fovY&nbsp;*&nbsp;180.0&nbsp;/&nbsp;M_PI,&nbsp;aspectRatio,&nbsp;0.1,&nbsp;1000);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
void&nbsp;ImageViewerCaptureTool::&lt;wbr&gt;initializeProperties(uint&nbsp;width,&nbsp;uint&nbsp;height)&nbsp;{&lt;br&gt;<br>
//&nbsp;initialize&nbsp;the&nbsp;hide&nbsp;viewer;&lt;br&gt;<br>
_viewer&nbsp;=&nbsp;new&nbsp;osgViewer::Viewer;&lt;br&gt;<br>
osg::Camera&nbsp;*camera&nbsp;=&nbsp;this-&gt;_viewer-&gt;getCamera();&lt;br&gt;<br>
osg::ref_ptr&lt;osg::&lt;wbr&gt;GraphicsContext::Traits&gt;&nbsp;traits&nbsp;=&nbsp;new&nbsp;osg::GraphicsContext::Traits;&lt;br&gt;<br>
traits-&gt;width&nbsp;=&nbsp;width;&lt;br&gt;<br>
traits-&gt;height&nbsp;=&nbsp;height;&lt;br&gt;<br>
traits-&gt;pbuffer&nbsp;=&nbsp;true;&lt;br&gt;<br>
traits-&gt;readDISPLAY();&lt;br&gt;<br>
osg::ref_ptr&lt;osg::&lt;wbr&gt;GraphicsContext&gt;&nbsp;gc&nbsp;=&nbsp;osg::GraphicsContext::&lt;wbr&gt;createGraphicsContext(traits.&lt;wbr&gt;get());&lt;br&gt;<br>
camera-&gt;setGraphicsContext(gc)&lt;wbr&gt;;&lt;br&gt;<br>
camera-&gt;setDrawBuffer(GL_&lt;wbr&gt;FRONT);&lt;br&gt;<br>
camera-&gt;setViewport(new&nbsp;osg::Viewport(0,&nbsp;0,&nbsp;width,&nbsp;height));&lt;br&gt;<br>
&lt;br&gt;<br>
//&nbsp;initialize&nbsp;the&nbsp;class&nbsp;to&nbsp;get&nbsp;the&nbsp;image&nbsp;in&nbsp;float&nbsp;data&nbsp;resolution&lt;br&gt;<br>
_capture&nbsp;=&nbsp;new&nbsp;WindowCaptureScreen(gc);&lt;br&gt;<br>
_viewer-&gt;getCamera()-&gt;&lt;wbr&gt;setFinalDrawCallback(_capture)&lt;wbr&gt;;&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
osg::ref_ptr&lt;osg::Image&gt;&nbsp;ImageViewerCaptureTool::&lt;wbr&gt;grabImage(osg::ref_ptr&lt;osg::&lt;wbr&gt;Node&gt;&nbsp;node&nbsp;)&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
_viewer-&gt;setSceneData(node);&lt;br&gt;<br>
_viewer-&gt;frame();&lt;br&gt;<br>
return&nbsp;_capture-&gt;captureImage();;&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
osg::ref_ptr&lt;osg::Image&gt;&nbsp;ImageViewerCaptureTool::&lt;wbr&gt;getDepthBuffer()&nbsp;{&lt;br&gt;<br>
return&nbsp;_capture-&gt;getDepthBuffer();&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
void&nbsp;ImageViewerCaptureTool::&lt;wbr&gt;setCameraPosition(&nbsp;const&nbsp;osg::Vec3d&amp;&nbsp;eye,&nbsp;const&nbsp;osg::Vec3d&amp;&nbsp;center,&nbsp;const&nbsp;osg::Vec3d&amp;&nbsp;up)&nbsp;{&lt;br&gt;<br>
_viewer-&gt;getCamera()-&gt;&lt;wbr&gt;setViewMatrixAsLookAt(eye,&nbsp;center,&nbsp;up);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
void&nbsp;ImageViewerCaptureTool::&lt;wbr&gt;getCameraPosition(&nbsp;osg::Vec3d&amp;&nbsp;eye,osg::Vec3d&amp;&nbsp;center,&nbsp;osg::Vec3d&amp;&nbsp;up)&nbsp;{&lt;br&gt;<br>
_viewer-&gt;getCamera()-&gt;&lt;wbr&gt;getViewMatrixAsLookAt(eye,&nbsp;center,&nbsp;up);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
void&nbsp;ImageViewerCaptureTool::&lt;wbr&gt;setBackgroundColor(osg::Vec4d&nbsp;color)&nbsp;{&lt;br&gt;<br>
_viewer-&gt;getCamera()-&gt;&lt;wbr&gt;setClearColor(color);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
//////////////////////////////&lt;wbr&gt;//&lt;br&gt;<br>
////WindowCaptureScreen&nbsp;METHODS&lt;br&gt;<br>
//////////////////////////////&lt;wbr&gt;//&lt;br&gt;<br>
&lt;br&gt;<br>
WindowCaptureScreen::&lt;wbr&gt;WindowCaptureScreen(osg::ref_&lt;wbr&gt;ptr&lt;osg::GraphicsContext&gt;&nbsp;gc)&nbsp;{&lt;br&gt;<br>
_mutex&nbsp;=&nbsp;new&nbsp;OpenThreads::Mutex();&lt;br&gt;<br>
_condition&nbsp;=&nbsp;new&nbsp;OpenThreads::Condition();&lt;br&gt;<br>
_image&nbsp;=&nbsp;new&nbsp;osg::Image();&lt;br&gt;<br>
_depth_buffer&nbsp;=&nbsp;new&nbsp;osg::Image();&lt;br&gt;<br>
&lt;br&gt;<br>
//&nbsp;checks&nbsp;the&nbsp;GraficContext&nbsp;from&nbsp;the&nbsp;camera&nbsp;viewer&lt;br&gt;<br>
if&nbsp;(gc-&gt;getTraits())&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
GLenum&nbsp;pixelFormat;&lt;br&gt;<br>
if&nbsp;(gc-&gt;getTraits()-&gt;alpha)&nbsp;pixelFormat&nbsp;=&nbsp;GL_RGBA;&lt;br&gt;<br>
else&nbsp;pixelFormat&nbsp;=&nbsp;GL_RGB;&lt;br&gt;<br>
&lt;br&gt;<br>
int&nbsp;width&nbsp;=&nbsp;gc-&gt;getTraits()-&gt;width;&lt;br&gt;<br>
int&nbsp;height&nbsp;=&nbsp;gc-&gt;getTraits()-&gt;height;&lt;br&gt;<br>
&lt;br&gt;<br>
//&nbsp;allocates&nbsp;the&nbsp;image&nbsp;memory&nbsp;space&lt;br&gt;<br>
_image-&gt;allocateImage(width,&nbsp;height,&nbsp;1,&nbsp;pixelFormat,&nbsp;GL_FLOAT);&lt;br&gt;<br>
_depth_buffer-&gt;allocateImage(&lt;wbr&gt;width,&nbsp;height,&nbsp;1,&nbsp;GL_DEPTH_COMPONENT,&nbsp;GL_FLOAT);&lt;br&gt;<br>
}&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
WindowCaptureScreen::~&lt;wbr&gt;WindowCaptureScreen()&nbsp;{&lt;br&gt;<br>
delete&nbsp;(_condition);&lt;br&gt;<br>
delete&nbsp;(_mutex);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
osg::ref_ptr&lt;osg::Image&gt;&nbsp;WindowCaptureScreen::&lt;wbr&gt;captureImage()&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
//wait&nbsp;to&nbsp;finish&nbsp;the&nbsp;capture&nbsp;image&nbsp;in&nbsp;call&nbsp;back&lt;br&gt;<br>
_condition-&gt;wait(_mutex);&lt;br&gt;<br>
return&nbsp;_image;&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
osg::ref_ptr&lt;osg::Image&gt;&nbsp;WindowCaptureScreen::&lt;wbr&gt;getDepthBuffer()&nbsp;{&lt;br&gt;<br>
return&nbsp;_depth_buffer;&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
void&nbsp;WindowCaptureScreen::operator&nbsp;()(osg::RenderInfo&amp;&nbsp;renderInfo)&nbsp;const&nbsp;{&lt;br&gt;<br>
osg::ref_ptr&lt;osg::&lt;wbr&gt;GraphicsContext&gt;&nbsp;gc&nbsp;=&nbsp;renderInfo.getState()-&gt;&lt;wbr&gt;getGraphicsContext();&lt;br&gt;<br>
if&nbsp;(gc-&gt;getTraits())&nbsp;{&lt;br&gt;<br>
_mutex-&gt;lock();&lt;br&gt;<br>
_image-&gt;readPixels(&nbsp;0,&nbsp;0,&nbsp;_image-&gt;s(),&nbsp;_image-&gt;t(),&nbsp;_image-&gt;getPixelFormat(),&nbsp;GL_FLOAT);&lt;br&gt;<br>
_depth_buffer-&gt;readPixels(0,&nbsp;0,&nbsp;_image-&gt;s(),&nbsp;_image-&gt;t(),&nbsp;_depth_buffer-&gt;getPixelFormat(&lt;wbr&gt;),&nbsp;GL_FLOAT);&lt;br&gt;<br>
&lt;br&gt;<br>
//grants&nbsp;the&nbsp;access&nbsp;to&nbsp;image&lt;br&gt;<br>
_condition-&gt;signal();&lt;br&gt;<br>
_mutex-&gt;unlock();&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;}&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you!&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Rômulo&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;------------------&lt;br&gt;<br>
Read&nbsp;this&nbsp;topic&nbsp;online&nbsp;here:&lt;br&gt;<br>
&lt;/span&gt;&lt;a&nbsp;href=&quot;http://forum.openscenegraph.org/viewtopic.php?p=71593#71593&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forum.openscenegraph.&lt;wbr&gt;org/viewtopic.php?p=71593#&lt;wbr&gt;71593&lt;/a&gt;&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.&lt;wbr&gt;org/listinfo.cgi/osg-users-&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
