<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Robert&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt; &lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;How&nbsp;long&nbsp;have&nbsp;you&nbsp;been&nbsp;using&nbsp;the&nbsp;OSG&nbsp;now?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Since&nbsp;2003?&nbsp;:-)&nbsp;..&nbsp;I&nbsp;knew&nbsp;the&nbsp;answer&nbsp;but&nbsp;I&nbsp;was&nbsp;&quot;hoping&quot;&nbsp;to&nbsp;maybe&nbsp;see&nbsp;some&nbsp;light&nbsp;in&nbsp;dealing&nbsp;with&nbsp;sort&nbsp;of&nbsp;very&nbsp;complex&nbsp;code.&nbsp;Here&nbsp;is&nbsp;the&nbsp;situation&nbsp;in&nbsp;brief:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;-&nbsp;for&nbsp;every&nbsp;frame&nbsp;I&nbsp;have&nbsp;dynaimic&nbsp;list&nbsp;of&nbsp;objects&nbsp;(lights,&nbsp;with&nbsp;rtt&nbsp;cameras&nbsp;attached)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;-&nbsp;In&nbsp;custom&nbsp;cull&nbsp;visitor&nbsp;I&nbsp;am&nbsp;getting&nbsp;a&nbsp;new&nbsp;list&nbsp;of&nbsp;sorted&nbsp;cameras&nbsp;(this&nbsp;must&nbsp;happen&nbsp;in&nbsp;the&nbsp;cull&nbsp;traversal&nbsp;for&nbsp;reasons)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;-&nbsp;now&nbsp;after&nbsp;the&nbsp;cull&nbsp;is&nbsp;done,&nbsp;I&nbsp;have&nbsp;to&nbsp;make&nbsp;the&nbsp;new&nbsp;list&nbsp;from&nbsp;the&nbsp;cull&nbsp;traversal&nbsp;&#39;active&#39;&nbsp;for&nbsp;the&nbsp;frame&nbsp;(active&nbsp;means,&nbsp;disable/erase&nbsp;the&nbsp;old&nbsp;list&nbsp;and&nbsp;making&nbsp;the&nbsp;new&nbsp;one&nbsp;actual&nbsp;-&nbsp;and&nbsp;these&nbsp;is&nbsp;by&nbsp;updating&nbsp;the&nbsp;scenegraph)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;But,&nbsp;while&nbsp;writing&nbsp;this&nbsp;I&nbsp;just&nbsp;recall&nbsp;what&nbsp;you&nbsp;did&nbsp;for&nbsp;the&nbsp;txp&nbsp;loader&nbsp;for&nbsp;the&nbsp;smart&nbsp;mesh&nbsp;handling&nbsp;with&nbsp;the&nbsp;TileMapper,&nbsp;where&nbsp;custom&nbsp;cull&nbsp;traversal&nbsp;is&nbsp;launched&nbsp;before&nbsp;the&nbsp;frame&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Please&nbsp;take&nbsp;my&nbsp;apologize&nbsp;for&nbsp;asking&nbsp;&#39;stupid&#39;&nbsp;questions&nbsp;;-),&nbsp;but&nbsp;sometime&nbsp;I&nbsp;struggle&nbsp;and&nbsp;the&nbsp;panic&nbsp;is&nbsp;faster&nbsp;then&nbsp;the&nbsp;rational&nbsp;thinking&nbsp;and&nbsp;the&nbsp;experience.&nbsp;I&nbsp;need&nbsp;it&nbsp;in&nbsp;written&nbsp;:-).&nbsp;Thanks&nbsp;again&nbsp;for&nbsp;the&nbsp;good&nbsp;description.&nbsp;Hope&nbsp;it&nbsp;will&nbsp;help&nbsp;others&nbsp;too&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Cheers,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Nick&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Sep&nbsp;10,&nbsp;2016&nbsp;at&nbsp;6:49&nbsp;PM,&nbsp;Robert&nbsp;Osfield&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:robert.osfield@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;robert.osfield@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;10&nbsp;September&nbsp;2016&nbsp;at&nbsp;12:42,&nbsp;Trajce&nbsp;Nikolov&nbsp;NICK&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:trajce.nikolov.nick@gmail.com&quot;&gt;trajce.nikolov.nick@gmail.com&lt;/a&gt;&lt;wbr&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;Community,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;me&nbsp;again&nbsp;:-)&nbsp;.. &nbsp;As&nbsp;the&nbsp;subject&nbsp;says,&nbsp;I&nbsp;an&nbsp;having&nbsp;the&nbsp;viewer&nbsp;setup&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;CullDrawThreadPerContext&nbsp;and&nbsp;I&nbsp;want&nbsp;to&nbsp;add&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cull&nbsp;traversal.&nbsp;Is&lt;br&gt;<br>
&gt;&nbsp;it&nbsp;safe&nbsp;to&nbsp;do&nbsp;so?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;How&nbsp;long&nbsp;have&nbsp;you&nbsp;been&nbsp;using&nbsp;the&nbsp;OSG&nbsp;now?&lt;br&gt;<br>
&lt;br&gt;<br>
Short&nbsp;answer.&nbsp;NO. &nbsp;Longer&nbsp;answer,&nbsp;NO&nbsp;it&#39;s&nbsp;not&nbsp;safe.&lt;br&gt;<br>
&lt;br&gt;<br>
Full&nbsp;answer:&nbsp;It&#39;s&nbsp;*not*&nbsp;generally&nbsp;safe&nbsp;to&nbsp;add&nbsp;nodes&nbsp;during&nbsp;any&lt;br&gt;<br>
traversal,&nbsp;especially&nbsp;the&nbsp;cull&nbsp;traversal. &nbsp;There&nbsp;are&nbsp;very&nbsp;specific&lt;br&gt;<br>
circumstances&nbsp;when&nbsp;it&nbsp;can&nbsp;be&nbsp;done&nbsp;during&nbsp;during&nbsp;a&nbsp;traversal&nbsp;but&nbsp;you&lt;br&gt;<br>
have&nbsp;to&nbsp;be&nbsp;fully&nbsp;aware&nbsp;of&nbsp;what&nbsp;can&nbsp;go&nbsp;wrong&nbsp;and&nbsp;make&nbsp;sure&nbsp;you&nbsp;don&#39;t&lt;br&gt;<br>
fall&nbsp;foul&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;potential&nbsp;problems.&lt;br&gt;<br>
&lt;br&gt;<br>
A&nbsp;major&nbsp;gotcha&nbsp;with&nbsp;changing&nbsp;the&nbsp;scene&nbsp;graph&nbsp;in&nbsp;the&nbsp;cull&nbsp;traversal&nbsp;is&lt;br&gt;<br>
that&nbsp;multiple&nbsp;camera&#39;s&nbsp;can&nbsp;have&nbsp;multiple&nbsp;threads&nbsp;running&nbsp;cull&lt;br&gt;<br>
traversals&nbsp;on&nbsp;them&nbsp;on&nbsp;parallel. &nbsp;If&nbsp;you&nbsp;wanted&nbsp;to&nbsp;go&nbsp;change&nbsp;the&nbsp;scene&lt;br&gt;<br>
graph&nbsp;when&nbsp;threading&nbsp;is&nbsp;happened&nbsp;then&nbsp;you&#39;d&nbsp;need&nbsp;to&nbsp;lock&nbsp;the&nbsp;node&nbsp;in&lt;br&gt;<br>
some&nbsp;way&nbsp;to&nbsp;prevent&nbsp;problems&nbsp;happening. &nbsp;There&nbsp;are&nbsp;lots&nbsp;of&nbsp;threading&lt;br&gt;<br>
pitfalls&nbsp;here&nbsp;-&nbsp;both&nbsp;for&nbsp;performance&nbsp;and&nbsp;obscure&nbsp;threading&nbsp;crashes.&lt;br&gt;<br>
&lt;br&gt;<br>
Another&nbsp;major&nbsp;issue&nbsp;is&nbsp;invalidation&nbsp;of&nbsp;iterators. &nbsp;If&nbsp;you&nbsp;have&nbsp;code&lt;br&gt;<br>
that&nbsp;traverses&nbsp;through&nbsp;a&nbsp;vector&nbsp;of&nbsp;children&nbsp;and&nbsp;as&nbsp;you&nbsp;handle&nbsp;one&nbsp;of&lt;br&gt;<br>
the&nbsp;children&nbsp;you&nbsp;decide&nbsp;it&#39;s&nbsp;time&nbsp;to&nbsp;add/remove/insert&nbsp;and&nbsp;new&nbsp;child&lt;br&gt;<br>
into&nbsp;the&nbsp;list&nbsp;being&nbsp;iterated&nbsp;then&nbsp;any&nbsp;reallocation&nbsp;of&nbsp;the&nbsp;vector&nbsp;being&lt;br&gt;<br>
iterator&nbsp;will&nbsp;invalidate&nbsp;the&nbsp;iterators. &nbsp;Invalidate&nbsp;the&nbsp;iterators&nbsp;and&lt;br&gt;<br>
bang&nbsp;you&#39;re&nbsp;app&nbsp;will&nbsp;go&nbsp;down&nbsp;in&nbsp;flames.&lt;br&gt;<br>
&lt;br&gt;<br>
So....&nbsp;in&nbsp;almost&nbsp;all&nbsp;instances&nbsp;trying&nbsp;to&nbsp;add/remove/insert&nbsp;nodes&lt;br&gt;<br>
during&nbsp;the&nbsp;cull&nbsp;traversal&nbsp;is&nbsp;REALLY&nbsp;BAD&nbsp;IDEA.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;really&nbsp;want&nbsp;to&nbsp;do&nbsp;it.&nbsp;Go&nbsp;do&nbsp;it,&nbsp;you&nbsp;have&nbsp;the&nbsp;source&nbsp;code,&nbsp;you&lt;br&gt;<br>
have&nbsp;debuggers,&nbsp;you&nbsp;can&nbsp;go&nbsp;shoot&nbsp;yourself&nbsp;in&nbsp;the&nbsp;foot&nbsp;or&nbsp;if&nbsp;your&nbsp;lucky&lt;br&gt;<br>
work&nbsp;out&nbsp;a&nbsp;really&nbsp;narrow&nbsp;and&nbsp;safe&nbsp;way&nbsp;to&nbsp;do&nbsp;what&nbsp;you&nbsp;want&nbsp;to&nbsp;do. &nbsp;I&lt;br&gt;<br>
won&#39;t&nbsp;nurse&nbsp;you&nbsp;along&nbsp;in&nbsp;this&nbsp;route&nbsp;though. &nbsp;Strong&nbsp;recommendation,&lt;br&gt;<br>
don&#39;t&nbsp;play&nbsp;silly&nbsp;buggers,&nbsp;don&#39;t&nbsp;try&nbsp;it.&nbsp;It&#39;ll&nbsp;save&nbsp;you&nbsp;lots&nbsp;of&nbsp;time.&lt;br&gt;<br>
&lt;br&gt;<br>
Far&nbsp;better&nbsp;is&nbsp;do&nbsp;what&nbsp;other&nbsp;multi-threaded&nbsp;parts&nbsp;of&nbsp;the&nbsp;OSG&nbsp;do,&nbsp;do&lt;br&gt;<br>
what&nbsp;the&nbsp;DatabasePager&nbsp;does,&nbsp;load&nbsp;data&nbsp;in&nbsp;a&nbsp;background&nbsp;thread,&lt;br&gt;<br>
incremental&nbsp;compile&nbsp;new&nbsp;objects,&nbsp;when&nbsp;compilation&nbsp;is&nbsp;complete&nbsp;merge&lt;br&gt;<br>
the&nbsp;subgraph&nbsp;with&nbsp;the&nbsp;main&nbsp;scene&nbsp;graph&nbsp;as&nbsp;an&nbsp;update&nbsp;operation&nbsp;prior&nbsp;to&lt;br&gt;<br>
the&nbsp;update&nbsp;and&nbsp;event&nbsp;traversals. &nbsp; &nbsp;This&nbsp;approach&nbsp;is&nbsp;safe,&nbsp;scales&lt;br&gt;<br>
well,&nbsp;is&nbsp;well&nbsp;established&nbsp;to&nbsp;work&nbsp;well&nbsp;for&nbsp;multi-threaded&nbsp;and&lt;br&gt;<br>
applications&nbsp;that&nbsp;need&nbsp;to&nbsp;target&nbsp;a&nbsp;solid&nbsp;60hz.&lt;br&gt;<br>
&lt;br&gt;<br>
Robert.&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.&lt;wbr&gt;org/listinfo.cgi/osg-users-&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;trajce&nbsp;nikolov&nbsp;nick&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
