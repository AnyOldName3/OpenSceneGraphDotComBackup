<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;OK.&nbsp;Scratch&nbsp;that,&nbsp;I&nbsp;no&nbsp;longer&nbsp;believe&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;performance&nbsp;measurement&nbsp;issue,&nbsp;but&nbsp;rather&nbsp;a&nbsp;performance&nbsp;issue.&nbsp;I&nbsp;have&nbsp;replaced&nbsp;my&nbsp;measurement&nbsp;code&nbsp;with&nbsp;the&nbsp;built&nbsp;in&nbsp;StatsHandler&nbsp;class,&nbsp;so&nbsp;my&nbsp;code&nbsp;now&nbsp;looks&nbsp;as&nbsp;follows:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;int&nbsp;main()&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;ref_ptr&lt;osgViewer::CompositeViewer&gt;&nbsp;viewer=new&nbsp;osgViewer::CompositeViewer();&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;ref_ptr&lt;osgViewer::View&gt;&nbsp;view1&nbsp;=&nbsp;new&nbsp;osgViewer::View;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;viewer-&gt;addView(view1);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;view1-&gt;addEventHandler(&nbsp;new&nbsp;osgViewer::StatsHandler&nbsp;);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;return&nbsp;viewer-&gt;run();&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;press&nbsp;S&nbsp;statshandler&nbsp;reports&nbsp;30-40fps.&nbsp;Obviously&nbsp;there&nbsp;is&nbsp;not&nbsp;a&nbsp;lot&nbsp;of&nbsp;room&nbsp;to&nbsp;have&nbsp;messed&nbsp;up&nbsp;in&nbsp;a&nbsp;5-liner&nbsp;program,&nbsp;so&nbsp;I&nbsp;believe&nbsp;that&nbsp;that&nbsp;is&nbsp;the&nbsp;actual&nbsp;framerate&nbsp;that&nbsp;I&nbsp;am&nbsp;getting.&nbsp;Question&nbsp;is&nbsp;why.&nbsp;I&nbsp;am&nbsp;running&nbsp;on&nbsp;a&nbsp;NVIDIA&nbsp;Geforce&nbsp;980Ti&nbsp;under&nbsp;Ubuntu&nbsp;14.04&nbsp;with&nbsp;nvidia&nbsp;driver&nbsp;version&nbsp;352.63)&nbsp;.&nbsp;I&nbsp;have&nbsp;optimization&nbsp;on&nbsp;(-O3&nbsp;under&nbsp;gcc)&nbsp; and&nbsp;believe&nbsp;that&nbsp;I&nbsp;am&nbsp;linking&nbsp;against&nbsp;release&nbsp;libraries&nbsp;not&nbsp;debug&nbsp;ones.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;ideas&nbsp;where&nbsp;to&nbsp;look??&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards&lt;/div&gt;&lt;div&gt;Hannes&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;----------&nbsp;Forwarded&nbsp;message&nbsp;----------&lt;br&gt;From:&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Hannes&nbsp;Naude&lt;/b&gt;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:naude.jj@gmail.com&quot;&gt;naude.jj@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&lt;br&gt;Date:&nbsp;Mon,&nbsp;Oct&nbsp;17,&nbsp;2016&nbsp;at&nbsp;1:46&nbsp;PM&lt;br&gt;Subject:&nbsp;OSG&nbsp;performance&nbsp;measurement&lt;br&gt;To:&nbsp;OpenSceneGraph&nbsp;Users&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Hi&nbsp;all &lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;New&nbsp;to&nbsp;OSG&nbsp;so&nbsp;apologies&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;stupid&nbsp;question.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;I&nbsp;have&nbsp;written&nbsp;a&nbsp;visualization&nbsp;tool&nbsp;in&nbsp;OSG&nbsp;and&nbsp;as&nbsp;a&nbsp;last&nbsp;step,&nbsp;I&nbsp;wish&nbsp;to&nbsp;ensure&nbsp;that&nbsp;it&nbsp;runs&nbsp;at&nbsp;the&nbsp;screen&nbsp;refresh&nbsp;rate.&nbsp;My&nbsp;perception&nbsp;was&nbsp;that&nbsp;it&nbsp;mostly&nbsp;runs&nbsp;smoothly&nbsp;but&nbsp;stutters&nbsp;every&nbsp;few&nbsp;frames&nbsp;or&nbsp;so,&nbsp;so&nbsp;I&nbsp;wrote&nbsp;code&nbsp;to&nbsp;print&nbsp;the&nbsp;elapsed&nbsp;time&nbsp;between&nbsp;every&nbsp;two&nbsp;frames,&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;average&nbsp;framerate.&nbsp;The&nbsp;printout&nbsp;seemed&nbsp;to&nbsp;confirm&nbsp;this,&nbsp;so&nbsp;I&nbsp;gradually&nbsp;removed&nbsp;more&nbsp;and&nbsp;more&nbsp;of&nbsp;my&nbsp;scenegraph,&nbsp;trying&nbsp;to&nbsp;determine&nbsp;where&nbsp;the&nbsp;bottleneck&nbsp;lies.&nbsp;The&nbsp;weird&nbsp;thing&nbsp;is&nbsp;that&nbsp;I&nbsp;end&nbsp;up&nbsp;with&nbsp;a&nbsp;completely&nbsp;empty&nbsp;scenegraph&nbsp;(just&nbsp;rendering&nbsp;a&nbsp;blue&nbsp;screen)&nbsp;and&nbsp;execution&nbsp;time&nbsp;STILL&nbsp;seems&nbsp;to&nbsp;stutter.&nbsp;So,&nbsp;I&nbsp;strongly&nbsp;suspect&nbsp;that&nbsp;there&nbsp;is&nbsp;something&nbsp;fundamentally&nbsp;wrong&nbsp;with&nbsp;the&nbsp;way&nbsp;I&nbsp;am&nbsp;measuring.&nbsp;I&nbsp;realise&nbsp;that&nbsp;FPS&nbsp;is&nbsp;a&nbsp;bad&nbsp;performance&nbsp;metric,&nbsp;but&nbsp;right&nbsp;now&nbsp;I&nbsp;just&nbsp;want&nbsp;to&nbsp;get&nbsp;to&nbsp;the&nbsp;point&nbsp;where&nbsp;I&nbsp;am&nbsp;updating&nbsp;every&nbsp;frame&nbsp;on&nbsp;my&nbsp;hardware&nbsp;and&nbsp;I&nbsp;am&nbsp;not&nbsp;particularly&nbsp;concerned&nbsp;about&nbsp;performance&nbsp;on&nbsp;any&nbsp;other&nbsp;hardware.&nbsp;The&nbsp;remaining&nbsp;code&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;int&nbsp;main()&nbsp;{&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;ref_ptr&lt;osgViewer::&lt;wbr&gt;CompositeViewer&gt;&nbsp;viewer=new&nbsp;osgViewer::CompositeViewer();&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&lt;/span&gt;ref_ptr&lt;osgViewer::View&gt;&nbsp;view1&nbsp;=&nbsp;new&nbsp;osgViewer::View;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;viewer-&gt;addView(view1);&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;float&nbsp;timeNow,timePrev=0;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;while&nbsp;(!viewer-&gt;done())&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;{&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;viewer-&gt;frame();&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;timeNow=osg::Timer::instance()&lt;wbr&gt;-&gt;time_s();&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;std::cout&nbsp;&lt;&lt;&nbsp;timeNow-timePrev&nbsp;&lt;&lt;&nbsp;&quot;&nbsp;&quot;;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;timePrev=timeNow;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;gmail-m_8011302020802418987gmail-Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;return(0);&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;}&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;and&nbsp;the&nbsp;resulting&nbsp;printout&nbsp;to&nbsp;the&nbsp;console&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;0.123003&nbsp;0.00298501&nbsp;0.000751987&nbsp;0.016045&nbsp;0.083418&nbsp;0.038128&nbsp;0.013075&nbsp;0.00068298&nbsp;0.014678&nbsp;0.019825&nbsp;0.013804&nbsp;0.016688&nbsp;0.01651&nbsp;0.066802&nbsp;0.023197&nbsp;0.07995&nbsp;0.013019&nbsp;0.000387967&nbsp;0.0331&nbsp;0.000599027&nbsp;0.03273&nbsp;0.000575006&nbsp;0.088067&nbsp;0.083023...&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;As&nbsp;you&nbsp;can&nbsp;see,&nbsp;the&nbsp;loop&nbsp;occasionally&nbsp;takes&nbsp;as&nbsp;much&nbsp;as&nbsp;88ms&nbsp;to&nbsp;complete,&nbsp;while&nbsp;at&nbsp;other&nbsp;time&nbsp;completing&nbsp;within&nbsp;0.6ms.&nbsp;What&nbsp;could&nbsp;possibly&nbsp;be&nbsp;causing&nbsp;this&nbsp;massive&nbsp;variation? &lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Regards&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Hannes&nbsp;Naude&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
