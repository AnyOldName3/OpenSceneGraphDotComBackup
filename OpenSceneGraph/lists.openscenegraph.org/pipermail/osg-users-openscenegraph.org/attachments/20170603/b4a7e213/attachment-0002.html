<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;For&nbsp;OpenGL&nbsp;3.2,&nbsp;I&#39;ve&nbsp;taken&nbsp;the&nbsp;approach&nbsp;of&nbsp;using&nbsp;an&nbsp;uniform&nbsp;block&nbsp;to&nbsp;replace&nbsp;the&nbsp;materials,&nbsp;(if&nbsp;you&nbsp;think&nbsp;about&nbsp;this&nbsp;materials&nbsp;are&nbsp;currently&nbsp;treated&nbsp;as&nbsp;something&nbsp;that&nbsp;is&nbsp;shared&nbsp;between&nbsp;all&nbsp;shaders,&nbsp;which&nbsp;is&nbsp;how&nbsp;they&nbsp;are&nbsp;implemented&nbsp;in&nbsp;the&nbsp;fixed&nbsp;function&nbsp;pipeline)&nbsp;each&nbsp;material&nbsp;has&nbsp;a&nbsp;buffer&nbsp;on&nbsp;the&nbsp;GPU,&nbsp;and&nbsp;I&nbsp;just&nbsp;switch&nbsp;the&nbsp;uniform&nbsp;block&nbsp;pointer&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;material&nbsp;apply.&nbsp;I&nbsp;found&nbsp;using&nbsp;callbacks&nbsp;really&nbsp;slowed&nbsp;down&nbsp;the&nbsp;scene&nbsp;graph&nbsp;update&nbsp;as&nbsp;the&nbsp;scene&nbsp;got&nbsp;larger.&nbsp;And&nbsp;there&nbsp;were&nbsp;also&nbsp;a&nbsp;number&nbsp;of&nbsp;bugs&nbsp;I&nbsp;hit&nbsp;by&nbsp;using&nbsp;material&nbsp;uniforms&nbsp;where&nbsp;scene&nbsp;graph&nbsp;optimizations&nbsp;seemed&nbsp;to&nbsp;lose&nbsp;them.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Gedalia&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jun&nbsp;1,&nbsp;2017&nbsp;at&nbsp;10:12&nbsp;AM,&nbsp;Robert&nbsp;Osfield&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:robert.osfield@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;robert.osfield@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;Goran,&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;standard&nbsp;OSG&nbsp;(3.2.x,&nbsp;3.4.0&nbsp;or&nbsp;the&nbsp;3.5.x&nbsp;dev&nbsp;series)&nbsp;there&nbsp;isn&#39;t&nbsp;any&lt;br&gt;<br>
way&nbsp;to&nbsp;automatically&nbsp;remap&nbsp;osg::Material&nbsp;to&nbsp;uniforms&nbsp;so&nbsp;you&#39;ll&nbsp;have&nbsp;to&lt;br&gt;<br>
run&nbsp;a&nbsp;traverser&nbsp;through&nbsp;the&nbsp;scene&nbsp;graph&nbsp;and&nbsp;replace&nbsp;the&nbsp;osg::Material&lt;br&gt;<br>
to&nbsp;osg::Uniform&#39;s.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;are&nbsp;willing&nbsp;to&nbsp;experiment&nbsp;with&nbsp;bleeding&nbsp;edge&nbsp;experimental&nbsp;code&lt;br&gt;<br>
then&nbsp;have&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;shader_pipeline&nbsp;branch&nbsp;of&nbsp;the&nbsp;OSG,&nbsp;in&nbsp;this&lt;br&gt;<br>
branch&nbsp;I&#39;m&nbsp;working&nbsp;on&nbsp;a&nbsp;new&nbsp;scheme&nbsp;for&nbsp;automatically&nbsp;mapping&nbsp;old&nbsp;fixed&lt;br&gt;<br>
function&nbsp;state&nbsp;like&nbsp;osg::Material&nbsp;to&nbsp;uniforms&nbsp;and&nbsp;#define&nbsp;settings&lt;br&gt;<br>
that&nbsp;can&nbsp;then&nbsp;be&nbsp;used&nbsp;by&nbsp;#pragma(tic)&nbsp;shader&nbsp;composition&nbsp;to&nbsp;provide&nbsp;a&lt;br&gt;<br>
fully&nbsp;integrated&nbsp;shader+fixed&nbsp;function&nbsp;state&nbsp;solution.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Robert.&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
On&nbsp;15&nbsp;May&nbsp;2017&nbsp;at&nbsp;14:18,&nbsp;Goran&nbsp;Pantar&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:gpantar@logicbricks.com&quot;&gt;gpantar@logicbricks.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;using&nbsp;OpenGL&nbsp;ES&nbsp;2.0&nbsp;and&nbsp;having&nbsp;dificulties&nbsp;to&nbsp;pass&nbsp;the&nbsp;old&nbsp;style&nbsp;material&nbsp;properties&nbsp;(ambient,&nbsp;difusse,&nbsp;specular,&nbsp;shininess)&nbsp;to&nbsp;the&nbsp;uniforms&nbsp;used&nbsp;in&nbsp;my&nbsp;fragment&nbsp;shader.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;For&nbsp;the&nbsp;3d&nbsp;model&nbsp;I&nbsp;use&nbsp;models&nbsp;in&nbsp;3ds&nbsp;format&nbsp;with&nbsp;multiple&nbsp;materials&nbsp;and&nbsp;multiple&nbsp;drawables.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;As&nbsp;a&nbsp;dirty&nbsp;hack&nbsp;I&nbsp;changed&nbsp;the&nbsp;Material.cpp&nbsp;Material::apply(State&amp;)&nbsp;function.&nbsp;This&nbsp;worked&nbsp;properly&nbsp;and&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;modify&nbsp;this&nbsp;several&nbsp;global&nbsp;uniforms&nbsp;used&nbsp;by&nbsp;my&nbsp;shader.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Now&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;do&nbsp;this&nbsp;the&nbsp;OSG&nbsp;way&nbsp;using&nbsp;updateCallbacks&nbsp;and&nbsp;visitors&nbsp;but&nbsp;the&nbsp;uniform&nbsp;are&nbsp;not&nbsp;updated&nbsp;during&nbsp;the&nbsp;rendering.&nbsp;Probably&nbsp;only&nbsp;the&nbsp;last&nbsp;drawable&nbsp;material&nbsp;properties&nbsp;are&nbsp;set&nbsp;to&nbsp;the&nbsp;uniform&nbsp;and&nbsp;than&nbsp;this&nbsp;is&nbsp;used&nbsp;when&nbsp;rendering.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;expect&nbsp;that&nbsp;there&nbsp;is&nbsp;some&nbsp;perfectly&nbsp;elegant&nbsp;way&nbsp;to&nbsp;do&nbsp;this,&nbsp;so&nbsp;please&nbsp;point&nbsp;me&nbsp;in&nbsp;the&nbsp;right&nbsp;direction.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thank&nbsp;you!&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Cheers,&lt;br&gt;<br>
&gt;&nbsp;Goran&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;------------------&lt;br&gt;<br>
&gt;&nbsp;Read&nbsp;this&nbsp;topic&nbsp;online&nbsp;here:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://forum.openscenegraph.org/viewtopic.php?p=70931#70931&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forum.openscenegraph.&lt;wbr&gt;org/viewtopic.php?p=70931#&lt;wbr&gt;70931&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
&gt;&nbsp;osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.&lt;wbr&gt;org/listinfo.cgi/osg-users-&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.&lt;wbr&gt;org/listinfo.cgi/osg-users-&lt;wbr&gt;openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;DI-Guy&nbsp;Engineering&nbsp;Lead,&nbsp;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;line-height:13px;color:black&quot;&gt;VT&nbsp;MÄK&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;150&nbsp;Cambridge&nbsp;Park&nbsp;Drive, &lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;3rd&nbsp;Floor, &lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;Cambridge,&nbsp;MA&nbsp;02140&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
