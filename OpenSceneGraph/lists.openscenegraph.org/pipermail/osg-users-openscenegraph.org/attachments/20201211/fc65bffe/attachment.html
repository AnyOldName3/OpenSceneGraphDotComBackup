<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;working&nbsp;on&nbsp;a&nbsp;node&nbsp;visitor&nbsp;that&nbsp;converts&nbsp;FFP&nbsp;state&nbsp;to&nbsp;shaders&nbsp;and&nbsp;am&nbsp;extending&nbsp;it&nbsp;so&nbsp;it&nbsp;can&nbsp;handle&nbsp;more&nbsp;than&nbsp;it&nbsp;used&nbsp;to.&nbsp;To&nbsp;avoid&nbsp;unnecessary&nbsp;state&nbsp;switches&nbsp;for&nbsp;things&nbsp;now&nbsp;handled&nbsp;by&nbsp;my&nbsp;shaders,&nbsp;I'm&nbsp;attempting&nbsp;to&nbsp;remove&nbsp;fixed-function-related&nbsp;state&nbsp;from&nbsp;the&nbsp;nodes&nbsp;which&nbsp;have&nbsp;had&nbsp;shaders&nbsp;set&nbsp;up.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;With&nbsp;modes,&nbsp;this&nbsp;works&nbsp;well&nbsp;-&nbsp;I&nbsp;can&nbsp;just&nbsp;set&nbsp;them&nbsp;off&nbsp;and&nbsp;protected,&nbsp;and&nbsp;the&nbsp;glEnable/glDisable&nbsp;calls&nbsp;go&nbsp;away.&nbsp;However,&nbsp;it's&nbsp;proving&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;the&nbsp;same&nbsp;behaviour&nbsp;with&nbsp;StateAttributes.&nbsp;The&nbsp;obvious&nbsp;solution&nbsp;would&nbsp;be&nbsp;removing&nbsp;the&nbsp;attribute&nbsp;from&nbsp;the&nbsp;StateSet&nbsp;it's&nbsp;attached&nbsp;to,&nbsp;but&nbsp;it&nbsp;might&nbsp;be&nbsp;higher&nbsp;in&nbsp;the&nbsp;scenegraph&nbsp;so&nbsp;also&nbsp;affect&nbsp;nodes&nbsp;which&nbsp;aren't&nbsp;having&nbsp;shaders&nbsp;attached,&nbsp;so&nbsp;it's&nbsp;only&nbsp;really&nbsp;safe&nbsp;to&nbsp;modify&nbsp;the&nbsp;stateset&nbsp;the&nbsp;shader&nbsp;program&nbsp;gets&nbsp;attached&nbsp;to.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;far,&nbsp;the&nbsp;best&nbsp;thing&nbsp;I've&nbsp;got&nbsp;is&nbsp;default-constructing&nbsp;the&nbsp;particular&nbsp;StateAttribute&nbsp;I'm&nbsp;interested&nbsp;in&nbsp;and&nbsp;attaching&nbsp;that&nbsp;to&nbsp;the&nbsp;stateset.&nbsp;This&nbsp;means&nbsp;the&nbsp;default&nbsp;state&nbsp;is&nbsp;set&nbsp;when&nbsp;the&nbsp;draw&nbsp;call&nbsp;happens,&nbsp;but&nbsp;I&nbsp;can&nbsp;see&nbsp;a&nbsp;lot&nbsp;of&nbsp;apply&nbsp;calls&nbsp;(resulting&nbsp;in&nbsp;a&nbsp;lot&nbsp;of&nbsp;GL&nbsp;calls)&nbsp;toggling&nbsp;between&nbsp;this&nbsp;copy&nbsp;of&nbsp;the&nbsp;default&nbsp;attribute&nbsp;and&nbsp;the&nbsp;copy&nbsp;in&nbsp;the&nbsp;state's&nbsp;attribute&nbsp;stack&nbsp;(via&nbsp;applyGlobalDefaultAttribute).&nbsp;I&nbsp;don't&nbsp;think&nbsp;it's&nbsp;wildly&nbsp;different&nbsp;from&nbsp;the&nbsp;number&nbsp;of&nbsp;unnecessary&nbsp;GL&nbsp;calls&nbsp;I&nbsp;was&nbsp;getting&nbsp;before&nbsp;I&nbsp;tried&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;solution&nbsp;that&nbsp;I&nbsp;think&nbsp;would&nbsp;work&nbsp;would&nbsp;be&nbsp;calling&nbsp;getGlobalDefaultAttribute&nbsp;on&nbsp;the&nbsp;State&nbsp;object&nbsp;as&nbsp;then&nbsp;the&nbsp;pointers&nbsp;would&nbsp;compare&nbsp;equal&nbsp;and&nbsp;the&nbsp;apply&nbsp;call&nbsp;would&nbsp;get&nbsp;skipped,&nbsp;but&nbsp;I&nbsp;don't&nbsp;have&nbsp;any&nbsp;clean&nbsp;way&nbsp;of&nbsp;getting&nbsp;the&nbsp;State&nbsp;instance&nbsp;to&nbsp;my&nbsp;visitor.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ideally,&nbsp;there'd&nbsp;be&nbsp;some&nbsp;neat&nbsp;trick&nbsp;I've&nbsp;missed&nbsp;that&nbsp;lets&nbsp;me&nbsp;say&nbsp;&quot;any&nbsp;subgraph&nbsp;of&nbsp;this&nbsp;node&nbsp;doesn't&nbsp;care&nbsp;about&nbsp;this&nbsp;attribute&nbsp;type,&nbsp;so&nbsp;set&nbsp;the&nbsp;default/leave&nbsp;whatever's&nbsp;there&nbsp;from&nbsp;the&nbsp;last&nbsp;draw&nbsp;call&quot;&nbsp;that&nbsp;would&nbsp;work&nbsp;with&nbsp;the&nbsp;normal&nbsp;state&nbsp;composition&nbsp;mechanisms&nbsp;so&nbsp;I&nbsp;could&nbsp;override&nbsp;it&nbsp;from&nbsp;a&nbsp;parent&nbsp;stateset&nbsp;or&nbsp;make&nbsp;it&nbsp;protected&nbsp;so&nbsp;it&nbsp;couldn't&nbsp;be&nbsp;overridden&nbsp;by&nbsp;parent&nbsp;statesets.&nbsp;Maybe&nbsp;a&nbsp;custom&nbsp;StateAttribute&nbsp;could&nbsp;do&nbsp;that,&nbsp;but&nbsp;maybe&nbsp;someone&nbsp;on&nbsp;this&nbsp;mailing&nbsp;list&nbsp;knows&nbsp;something&nbsp;I&nbsp;don't&nbsp;already.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chris&lt;/div&gt;<br>
<br>
&lt;p&gt;&lt;/p&gt;<br>
<br>
--&nbsp;&lt;br&nbsp;/&gt;<br>
You&nbsp;received&nbsp;this&nbsp;message&nbsp;because&nbsp;you&nbsp;are&nbsp;subscribed&nbsp;to&nbsp;the&nbsp;Google&nbsp;Groups&nbsp;&quot;OpenSceneGraph&nbsp;Users&quot;&nbsp;group.&lt;br&nbsp;/&gt;<br>
To&nbsp;unsubscribe&nbsp;from&nbsp;this&nbsp;group&nbsp;and&nbsp;stop&nbsp;receiving&nbsp;emails&nbsp;from&nbsp;it,&nbsp;send&nbsp;an&nbsp;email&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;mailto:osg-users+unsubscribe@googlegroups.com&quot;&gt;osg-users+unsubscribe@googlegroups.com&lt;/a&gt;.&lt;br&nbsp;/&gt;<br>
To&nbsp;view&nbsp;this&nbsp;discussion&nbsp;on&nbsp;the&nbsp;web&nbsp;visit&nbsp;&lt;a&nbsp;href=&quot;https://groups.google.com/d/msgid/osg-users/5132cc44-84f8-4395-bd54-b2e88d02f67en%40googlegroups.com?utm_medium=email&amp;utm_source=footer&quot;&gt;https://groups.google.com/d/msgid/osg-users/5132cc44-84f8-4395-bd54-b2e88d02f67en%40googlegroups.com&lt;/a&gt;.&lt;br&nbsp;/&gt;<br>

</tt>
