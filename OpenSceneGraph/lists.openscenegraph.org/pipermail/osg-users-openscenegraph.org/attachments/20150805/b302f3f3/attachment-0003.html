<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;Clement,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;have&nbsp;tried&nbsp;Julian&#39;s&nbsp;suggested&nbsp;approach&nbsp;of&nbsp;assign&nbsp;the&nbsp;num_iterations&nbsp;to&nbsp;an&nbsp;int&nbsp;and&nbsp;it&nbsp;works,&nbsp;simplify&nbsp;his&nbsp;original&nbsp;suggestion&nbsp;I&nbsp;get:&lt;br&gt;&lt;br&gt;&lt;/div&gt;Original&nbsp;shader&nbsp;line&nbsp;that&nbsp;results&nbsp;in&nbsp;hang:&lt;br&gt;&lt;br&gt;float&nbsp;num_iterations&nbsp;=&nbsp;ceil(length((te-t0).xyz)/SampleDensityValue);&lt;br&gt;&lt;br&gt;&lt;/div&gt;Revised&nbsp;shader&nbsp;line&nbsp;that&nbsp;works&nbsp;fine:&lt;br&gt;&lt;br&gt;int&nbsp;num_iterations&nbsp;=&nbsp;ceil(length((te-t0).xyz)/SampleDensityValue);&lt;br&gt;&lt;br&gt;&lt;/div&gt;Now,&nbsp;these&nbsp;both&nbsp;should&nbsp;result&nbsp;in&nbsp;the&nbsp;same&nbsp;value,&nbsp;as&nbsp;ceil&nbsp;rounds&nbsp;to&nbsp;an&nbsp;integer&nbsp;value,&nbsp;abeit&nbsp;within&nbsp;the&nbsp;scope&nbsp;of&nbsp;floating&nbsp;point&nbsp;math.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Curiously&nbsp;the&nbsp;modern&nbsp;MultiPassTechnique&nbsp;shaders&nbsp;work&nbsp;fine&nbsp;too&nbsp;and&nbsp;they&nbsp;use&nbsp;an&nbsp;int. &nbsp;Originally&nbsp;I&nbsp;didn&#39;t&nbsp;use&nbsp;an&nbsp;int&nbsp;for&nbsp;the&nbsp;num_iterations&nbsp;as&nbsp;early&nbsp;GLSL&nbsp;implementations&nbsp;didn&#39;t&nbsp;fully&nbsp;support&nbsp;int&#39;s.&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;think&nbsp;the&nbsp;best&nbsp;solution&nbsp;would&nbsp;be&nbsp;to&nbsp;modify&nbsp;the&nbsp;shaders&nbsp;to&nbsp;all&nbsp;use&nbsp;int&#39;s&nbsp;for&nbsp;the&nbsp;num_iterations&nbsp;as&nbsp;a&nbsp;general&nbsp;coding&nbsp;approach&nbsp;using&nbsp;int&#39;s&nbsp;is&nbsp;sound. &nbsp;It&nbsp;shouldn&#39;t&nbsp;however&nbsp;be&nbsp;need&nbsp;a&nbsp;float&nbsp;should&nbsp;work&nbsp;in&nbsp;this&nbsp;context&nbsp;just&nbsp;as&nbsp;well&nbsp;as&nbsp;a&nbsp;int. &nbsp;What&nbsp;I&nbsp;suspect&nbsp;is&nbsp;that&nbsp;at&nbsp;certain&nbsp;values&nbsp;there&nbsp;is&nbsp;some&nbsp;kind&nbsp;of&nbsp;numerical&nbsp;bug&nbsp;on&nbsp;the&nbsp;GPU&nbsp;or&nbsp;perhaps&nbsp;driver&nbsp;that&nbsp;is&nbsp;resulting&nbsp;in&nbsp;an&nbsp;invalid&nbsp;float&nbsp;point&nbsp;value. &nbsp;Casting&nbsp;from&nbsp;float&nbsp;to&nbsp;int&nbsp;seems&nbsp;to&nbsp;nip&nbsp;this&nbsp;error&nbsp;in&nbsp;the&nbsp;bud&nbsp;so&nbsp;it&nbsp;doesn&#39;t&nbsp;propagate.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&#39;s&nbsp;end&nbsp;of&nbsp;day&nbsp;here&nbsp;so&nbsp;I&#39;ll&nbsp;have&nbsp;to&nbsp;make&nbsp;the&nbsp;changes&nbsp;and&nbsp;test&nbsp;them&nbsp;tomorrow&nbsp;and&nbsp;will&nbsp;update&nbsp;OpenSceneGraph-Data&nbsp;and&nbsp;OSG-3.2,&nbsp;OSG-3.4&nbsp;an&nbsp;OSG-svn/trunk&nbsp;branches.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Robert.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Robert.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;5&nbsp;August&nbsp;2015&nbsp;at&nbsp;17:46,&nbsp;Robert&nbsp;Osfield&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:robert.osfield@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;robert.osfield@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Clement,&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;5&nbsp;August&nbsp;2015&nbsp;at&nbsp;17:06,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:Clement.Chu@csiro.au&quot;&nbsp;target=&quot;_blank&quot;&gt;Clement.Chu@csiro.au&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
<br>
<br>
&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;direction:ltr;font-family:Tahoma;color:#000000;font-size:10pt&quot;&gt; &nbsp;Thanks&nbsp;for&nbsp;your&nbsp;help&nbsp;to&nbsp;test&nbsp;the&nbsp;problem. &nbsp;Please&nbsp;find&nbsp;the&nbsp;attachment&nbsp;of&nbsp;my&nbsp;test&nbsp;data.  &nbsp;I&nbsp;tested&nbsp;with&nbsp;my&nbsp;laptop&nbsp;(Nvidia&nbsp;NVS&nbsp;5200M&nbsp;with&nbsp;driver&nbsp;353.62)&nbsp;and&nbsp;used&nbsp;osg&nbsp;3.2.1&nbsp;x64&nbsp;windows&nbsp;version. &nbsp;The&nbsp;command&nbsp;is:&lt;br&gt;<br>
&lt;br&gt;<br>
osgviewer&nbsp;t1.osg&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;model.&lt;br&gt;&lt;br&gt;I&#39;ve&nbsp;run&nbsp;it&nbsp;on&nbsp;my&nbsp;Kubuntu&nbsp;system&nbsp;with&nbsp;Geforce&nbsp;GTX&nbsp;760&nbsp;+&nbsp;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt;346.59&nbsp;drives&nbsp;and&nbsp;get&nbsp;a&nbsp;hang&nbsp;on&nbsp;my&nbsp;system&nbsp;when&nbsp;I&nbsp;rotate&nbsp;the&nbsp;view. &nbsp;This&nbsp;happens&nbsp;with&nbsp;OSG&nbsp;svn/trunk&nbsp;(equivalent&nbsp;to&nbsp;OSG-3.4). &nbsp;When&nbsp;I&nbsp;run&nbsp;osgvolume&nbsp;t1.dds&nbsp;I&nbsp;get&nbsp;the&nbsp;hang&nbsp;as&nbsp;well. &nbsp;Given&nbsp;the&nbsp;nature&nbsp;of&nbsp;the&nbsp;hang&nbsp;and&nbsp;how&nbsp;it&nbsp;locks&nbsp;out&nbsp;the&nbsp;whole&nbsp;desktop&nbsp;it&nbsp;all&nbsp;points&nbsp;to&nbsp;GPU/driver&nbsp;issue&nbsp;of&nbsp;some&nbsp;kind.&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt;If&nbsp;I&nbsp;run:&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt; &nbsp;osgvolume&nbsp;t1.dds&nbsp;--multi-pass&nbsp;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt;I&nbsp;don&#39;t&nbsp;get&nbsp;any&nbsp;hang. &nbsp;The&nbsp;osgVolume::MultiPassTechnique&nbsp;is&nbsp;only&nbsp;part&nbsp;of&nbsp;OSG-3.4&nbsp;so&nbsp;you&nbsp;won&#39;t&nbsp;have&nbsp;this&nbsp;option&nbsp;when&nbsp;using&nbsp;OSG3.2.1. &nbsp;By&nbsp;default&nbsp;osgvolume&nbsp;still&nbsp;defaults&nbsp;to&nbsp;the&nbsp;old&nbsp;RayTracedTechnique&nbsp;that&nbsp;you&#39;ll&nbsp;be&nbsp;familiar&nbsp;with,&nbsp;so&nbsp;I&nbsp;would&nbsp;suspect&nbsp;an&nbsp;issue&nbsp;with&nbsp;how&nbsp;the&nbsp;GPU&nbsp;is&nbsp;managing&nbsp;the&nbsp;RayTracedTechnique&nbsp;GLSL&nbsp;shaders.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt;The&nbsp;thread&nbsp;that&nbsp;Julian&nbsp;Valentin&nbsp;linked&nbsp;discusses&nbsp;potentially&nbsp;the&nbsp;same&nbsp;issue,&nbsp;although&nbsp;the&nbsp;GLSL&nbsp;code&nbsp;Julian&nbsp;suggesting&nbsp;could&nbsp;be&nbsp;changed&nbsp;looks&nbsp;valid&nbsp;and&nbsp;the&nbsp;fix&nbsp;a&nbsp;workaround&nbsp;to&nbsp;otherwise&nbsp;valid&nbsp;code. &nbsp;I&nbsp;will&nbsp;do&nbsp;a&nbsp;review&nbsp;of&nbsp;the&nbsp;shaders&nbsp;to&nbsp;see&nbsp;I&nbsp;can&nbsp;spot&nbsp;a&nbsp;problem.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt;Robert.&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:#000000;background-color:#ffffff&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;<br>
&lt;br&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
