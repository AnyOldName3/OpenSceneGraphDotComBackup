<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;Robert,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Yes,&nbsp;the&nbsp;model&nbsp;is&nbsp;ineffective&nbsp;in&nbsp;the&nbsp;sense&nbsp;that&nbsp;it&nbsp;has&nbsp;150&nbsp;000<br>
&nbsp;&nbsp;&nbsp;&nbsp;separate&nbsp;triangles&nbsp;on&nbsp;the&nbsp;same&nbsp;level&nbsp;in&nbsp;the&nbsp;scene&nbsp;graph,&nbsp;that's&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;nature&nbsp;of&nbsp;basic&nbsp;usage&nbsp;of&nbsp;OpenFlight&nbsp;and&nbsp;I&nbsp;guess&nbsp;that's&nbsp;why&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;plugin&nbsp;applies&nbsp;an&nbsp;optimization&nbsp;of&nbsp;its&nbsp;own.&nbsp;But&nbsp;this&nbsp;could&nbsp;be<br>
&nbsp;&nbsp;&nbsp;&nbsp;optimized&nbsp;and&nbsp;merged&nbsp;much&nbsp;faster&nbsp;before&nbsp;and&nbsp;I'm&nbsp;just&nbsp;looking&nbsp;for&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;way&nbsp;to&nbsp;get&nbsp;it&nbsp;to&nbsp;behave&nbsp;like&nbsp;that&nbsp;again,&nbsp;to&nbsp;keep&nbsp;my&nbsp;software&nbsp;from<br>
&nbsp;&nbsp;&nbsp;&nbsp;being&nbsp;slower&nbsp;in&nbsp;a&nbsp;new&nbsp;version.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some&nbsp;results&nbsp;from&nbsp;VTune,&nbsp;where&nbsp;I&nbsp;have&nbsp;manually&nbsp;filtered&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;presented&nbsp;the&nbsp;top&nbsp;two&nbsp;culprits&nbsp;in&nbsp;3.5.1&nbsp;compared&nbsp;to&nbsp;3.5.8&nbsp;(where&nbsp;I<br>
&nbsp;&nbsp;&nbsp;&nbsp;gave&nbsp;up&nbsp;after&nbsp;2&nbsp;minutes):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.5.8:&nbsp;TOTAL:&nbsp;121.4s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;&lt;tt&gt;Registry::read&nbsp;-&gt;&nbsp;Optimizer::optimize&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MergeGeometryVisitor::mergeGroup&nbsp;-&gt;&nbsp;Group::removeChildren<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;OpenThreads::Atomic::operator++&nbsp;(78.5s)&lt;/tt&gt;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;&lt;tt&gt;Registry::read&nbsp;-&gt;&nbsp;Optimizer::optimize&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MergeGeometryVisitor::mergeGroup&nbsp;-&gt;&nbsp;Group::removeChildren<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;OpenThreads::Atomic::operator--&nbsp;(27.4s)&lt;/tt&gt;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;3.5.1:&nbsp;TOTAL:&nbsp;12.7s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;&lt;tt&gt;Registry::read&nbsp;-&gt;&nbsp;Optimizer::optimize&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Optimizer::StateVisitor::optimize&nbsp;-&gt;&nbsp;Node::setStateSet<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;StateSet::~StateSet&nbsp;-&gt;&nbsp;StateSet::clear&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StateAttribute::removeParent&nbsp;(2.4s)&lt;/tt&gt;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;&lt;tt&gt;Registry::read&nbsp;-&gt;&nbsp;Optimizer::optimize&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Optimizer::MergeGeodesVisitor::mergeGeodes&nbsp;-&gt;&nbsp;Node::~Node<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Node::setStateSet&nbsp;-&gt;&nbsp;StateAttribute::removeParent<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2.2s)&lt;/tt&gt;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;MergeGeometryVisitor&nbsp;was&nbsp;applied&nbsp;in&nbsp;3.5.1&nbsp;as&nbsp;well&nbsp;but&nbsp;didn't<br>
&nbsp;&nbsp;&nbsp;&nbsp;take&nbsp;more&nbsp;than&nbsp;about&nbsp;0.06s.&nbsp;I&nbsp;guess&nbsp;the&nbsp;3.5.1&nbsp;results&nbsp;are&nbsp;generally<br>
&nbsp;&nbsp;&nbsp;&nbsp;less&nbsp;interesting&nbsp;but&nbsp;at&nbsp;least&nbsp;they&nbsp;show&nbsp;that&nbsp;MergeGeometryVisitor<br>
&nbsp;&nbsp;&nbsp;&nbsp;was&nbsp;not&nbsp;a&nbsp;problem&nbsp;there.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;don't&nbsp;know&nbsp;if&nbsp;this&nbsp;gives&nbsp;you&nbsp;some&nbsp;ideas&nbsp;directly&nbsp;or&nbsp;if&nbsp;we&nbsp;need&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;digging.&nbsp;I&nbsp;will&nbsp;have&nbsp;another&nbsp;look&nbsp;shortly&nbsp;either&nbsp;way,&nbsp;but&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;course&nbsp;hoping&nbsp;for&nbsp;you&nbsp;or&nbsp;someone&nbsp;else&nbsp;to&nbsp;come&nbsp;up&nbsp;with&nbsp;some&nbsp;bright<br>
&nbsp;&nbsp;&nbsp;&nbsp;ideas&nbsp;to&nbsp;shorten&nbsp;the&nbsp;time&nbsp;to&nbsp;fixing&nbsp;this&nbsp;problem.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Andreas&lt;font&nbsp;size=&quot;2&quot;&nbsp;color=&quot;black&quot;&gt;&lt;span<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style=&quot;font-size:0.8em;color:black&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;/font&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;color=&quot;black&quot;&gt;&lt;span<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style=&quot;font-size:0.8em;color:black&quot;&gt;&lt;/span&gt;&lt;/font&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-signature&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;color=&quot;black&quot;&gt;&lt;span<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style=&quot;font-size:0.8em;color:black&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;/font&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;On&nbsp;2017-11-19&nbsp;16:28,&nbsp;Robert&nbsp;Osfield<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CAFN7Y+VZf3Fy9gD0KnudHv7on4EaSYQBfvztWaQ1SHEnfY+hGQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;HI&nbsp;Andreas,<br>
<br>
I&nbsp;haven't&nbsp;had&nbsp;a&nbsp;chance&nbsp;to&nbsp;dig&nbsp;further.<br>
<br>
One&nbsp;curious&nbsp;thing&nbsp;I&nbsp;noticed&nbsp;is&nbsp;that&nbsp;when&nbsp;I&nbsp;enabled&nbsp;verbose&nbsp;debug<br>
output&nbsp;there&nbsp;was&nbsp;lots&nbsp;of&nbsp;buffer&nbsp;objects&nbsp;being&nbsp;created&nbsp;and&nbsp;destroyed<br>
during&nbsp;the&nbsp;optimisation&nbsp;step.&nbsp;&nbsp;osg::Drawable&nbsp;now&nbsp;assigns<br>
VetextArrayState&nbsp;and&nbsp;VBO's&nbsp;by&nbsp;default&nbsp;for&nbsp;osg::Geometry&nbsp;-&nbsp;this&nbsp;is<br>
required&nbsp;to&nbsp;make&nbsp;VAO&nbsp;support&nbsp;possible.&nbsp;&nbsp;The&nbsp;large&nbsp;number&nbsp;of&nbsp;these<br>
operations&nbsp;suggest&nbsp;lots&nbsp;of&nbsp;creation&nbsp;and&nbsp;merging&nbsp;of&nbsp;osg::Geometry&nbsp;for<br>
this&nbsp;dataset.&nbsp;&nbsp;There&nbsp;is&nbsp;chance&nbsp;tthat&nbsp;this&nbsp;change&nbsp;alone&nbsp;may&nbsp;be&nbsp;causing<br>
a&nbsp;performance&nbsp;slow&nbsp;down.<br>
<br>
However,&nbsp;I&nbsp;don't&nbsp;think&nbsp;creation/deletion&nbsp;of&nbsp;osg::Geometry&nbsp;is&nbsp;the&nbsp;crux<br>
of&nbsp;the&nbsp;problem,&nbsp;and&nbsp;may&nbsp;not&nbsp;even&nbsp;be&nbsp;the&nbsp;optimization&nbsp;step&nbsp;-&nbsp;it&nbsp;could<br>
well&nbsp;be&nbsp;down&nbsp;to&nbsp;the&nbsp;nature&nbsp;of&nbsp;the&nbsp;scene&nbsp;graph&nbsp;being&nbsp;created&nbsp;by&nbsp;the<br>
OpenFlight&nbsp;plugin&nbsp;for&nbsp;this&nbsp;dataset.&nbsp;&nbsp;I&nbsp;suspect&nbsp;the&nbsp;source&nbsp;data&nbsp;is<br>
stored&nbsp;in&nbsp;a&nbsp;way&nbsp;that&nbsp;is&nbsp;really&nbsp;inefficient&nbsp;to&nbsp;handle&nbsp;for&nbsp;real-time.<br>
It&nbsp;might&nbsp;be&nbsp;that&nbsp;the&nbsp;OpenFlight&nbsp;plugin&nbsp;just&nbsp;isn't&nbsp;handling&nbsp;the&nbsp;data<br>
well.<br>
<br>
As&nbsp;a&nbsp;general&nbsp;rule,&nbsp;running&nbsp;the&nbsp;Optimizer&nbsp;is&nbsp;a&nbsp;last&nbsp;resort&nbsp;for&nbsp;fixing<br>
really&nbsp;bad&nbsp;datasets,&nbsp;ideally&nbsp;datasets&nbsp;should&nbsp;be&nbsp;created&nbsp;in&nbsp;a&nbsp;form&nbsp;that<br>
is&nbsp;appropriate&nbsp;for&nbsp;decent&nbsp;performance&nbsp;right&nbsp;from&nbsp;the&nbsp;start.<br>
<br>
Robert.<br>
_______________________________________________<br>
osg-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&gt;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&lt;/a&gt;<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
