<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&nbsp;Igor,&lt;div&gt;&lt;br&gt;&lt;div&gt;I &nbsp;got&nbsp;interested&nbsp;in&nbsp;this&nbsp;problem&nbsp;and&nbsp;checked&nbsp;your&nbsp;code&nbsp;by&nbsp;converting&nbsp;it&nbsp;to&nbsp;pure&nbsp;osgViewer.&nbsp;Here&nbsp;are&nbsp;my&nbsp;observations:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;believe&nbsp;you&nbsp;do&nbsp;have&nbsp;circular&nbsp;reference.&nbsp;Your&nbsp;class&nbsp;Scene&nbsp;is&nbsp;a&nbsp;callback.&nbsp;So&nbsp;RootNode&nbsp;points&nbsp;to&nbsp;callback&nbsp;but&nbsp;Scene&nbsp;callback&nbsp;points&nbsp;to&nbsp;RootNode.&nbsp;Hence&nbsp;circular&nbsp;ref.&lt;/div&gt;&lt;div&gt;However,&nbsp;this&nbsp;does&nbsp;not&nbsp;explain&nbsp;increased&nbsp;ref&nbsp;count&nbsp;of&nbsp;your&nbsp;geometries.&nbsp;But&nbsp;I&nbsp;believe&nbsp;this&nbsp;issue&nbsp;can&nbsp;be&nbsp;explained&nbsp;by&nbsp;by&nbsp;lazy&nbsp;clearing&nbsp;of&nbsp;render&nbsp;bins.&nbsp;RenderBins&nbsp;are&nbsp;not &lt;br&gt;&lt;/div&gt;&lt;div&gt;cleared&nbsp;after&nbsp;Draw&nbsp;but&nbsp;before&nbsp;next&nbsp;frame&nbsp;Draw.&nbsp;So&nbsp;after&nbsp;your&nbsp;Update,&nbsp;your&nbsp;geometry&nbsp;is&nbsp;Culled/Drawn&nbsp;and&nbsp;lands&nbsp;in&nbsp;RenderLeaves&nbsp;of&nbsp;RenderBin.&nbsp;This&nbsp;RenderBin&nbsp;is&nbsp;used&nbsp;to&nbsp;draw&nbsp;visible&nbsp;geometries&nbsp;but&nbsp;its&nbsp;not&nbsp;cleared&nbsp;after&nbsp;Draw.&nbsp;Its&nbsp;cleared&nbsp;later,&nbsp;ie&nbsp;on&nbsp;next&nbsp;Cull/Draw&nbsp;traversal&nbsp;when&nbsp;RenderLeaves&nbsp;container&nbsp;cleared&nbsp;before&nbsp;it&nbsp;gets&nbsp;filled&nbsp;again.&nbsp;So&nbsp;on&nbsp;next&nbsp;Update&nbsp;you&nbsp;will&nbsp;notice&nbsp;increased&nbsp;ref&nbsp;count&nbsp;because&nbsp;its&nbsp;also&nbsp;added&nbsp;to&nbsp;RenderLeaves&nbsp;container.&nbsp;But&nbsp;the&nbsp;next&nbsp;Cull/Draw&nbsp;will&nbsp;clear&nbsp;RenderLeaves&nbsp;and&nbsp;your&nbsp;geometry&nbsp;will&nbsp;be&nbsp;finally&nbsp;released.&nbsp;Here&nbsp;is&nbsp;your&nbsp;modified&nbsp;test&nbsp;applet&nbsp;code&nbsp;ported&nbsp;to&nbsp;vanilla&nbsp;osgViewer&nbsp;and&nbsp;modified&nbsp;to&nbsp;use&nbsp;observer_ptr&nbsp;instead&nbsp;of&nbsp;ref_ptr&nbsp;for&nbsp;RootNode.&nbsp;I&nbsp;have&nbsp;put&nbsp;breakpoint&nbsp;in&nbsp;MyGeometry&nbsp;Destructor&nbsp;to&nbsp;see&nbsp;the&nbsp;call&nbsp;stack&nbsp;and&nbsp;the&nbsp;call&nbsp;where&nbsp;the&nbsp;geometry&nbsp;is&nbsp;actually&nbsp;released&nbsp;and&nbsp;that&nbsp;way&nbsp;I&nbsp;found&nbsp;the&nbsp;explanation.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&nbsp;hth,&lt;/div&gt;&lt;div&gt;Wojtek&nbsp;Lewandowski &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;czw.,&nbsp;12&nbsp;lip&nbsp;2018&nbsp;o&nbsp;21:49 Igor&nbsp;Spiridonov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:igwasm@rambler.ru&quot;&nbsp;target=&quot;_blank&quot;&gt;igwasm@rambler.ru&lt;/a&gt;&gt;&nbsp;napisał(a):&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Here&nbsp;is&nbsp;simple&nbsp;project&nbsp;which&nbsp;reproduces&nbsp;this&nbsp;issue&nbsp;-&nbsp;RefCountTest&nbsp;(&lt;a&nbsp;href=&quot;https://bitbucket.org/OmegaDoom/osgrefcounttest&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bitbucket.org/OmegaDoom/osgrefcounttest&lt;/a&gt;)&lt;br&gt;<br>
&lt;br&gt;<br>
It&#39;s&nbsp;a&nbsp;visual&nbsp;studio&nbsp;project&nbsp;with&nbsp;qt&nbsp;and&nbsp;osg.&nbsp;Not&nbsp;sure&nbsp;you&nbsp;are&nbsp;using&nbsp;windows&nbsp;but&nbsp;the&nbsp;main&nbsp;code&nbsp;in&nbsp;scene.cpp.&nbsp;ref&nbsp;count&nbsp;checks&nbsp;inside&nbsp;&quot;Scene::operator()(osg::Node*&nbsp;node,&nbsp;osg::NodeVisitor*&nbsp;nv)&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;expect&nbsp;both&nbsp;checks&nbsp;to&nbsp;return&nbsp;1&nbsp;but&nbsp;first&nbsp;one&nbsp;returns&nbsp;2&nbsp;as&nbsp;I&nbsp;explained&nbsp;earlier.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;suppose&nbsp;it&#39;s&nbsp;the&nbsp;cause&nbsp;of&nbsp;memleak.&nbsp;I&nbsp;use&nbsp;osg&nbsp;3.2.&lt;br&gt;<br>
&lt;br&gt;<br>
------------------&lt;br&gt;<br>
Read&nbsp;this&nbsp;topic&nbsp;online&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://forum.openscenegraph.org/viewtopic.php?p=74334#74334&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forum.openscenegraph.org/viewtopic.php?p=74334#74334&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&nbsp;target=&quot;_blank&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
