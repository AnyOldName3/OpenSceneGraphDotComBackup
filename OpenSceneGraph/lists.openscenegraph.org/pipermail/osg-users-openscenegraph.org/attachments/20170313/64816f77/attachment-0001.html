<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hello,&lt;/div&gt;&lt;div&gt; &nbsp; I&#39;ve&nbsp;seen&nbsp;that&nbsp;OSG&nbsp;has&nbsp;some&nbsp;basic&nbsp;primitives&nbsp;for&nbsp;uniform&nbsp;buffers,&nbsp;but&nbsp;they&nbsp;seem&nbsp;designed&nbsp;for&nbsp;homogeneous&nbsp;data.&nbsp;Most&nbsp;modern&nbsp;engines&nbsp;use&nbsp;uniform&nbsp;buffers&nbsp;to&nbsp;represent&nbsp;various&nbsp;levels&nbsp;of&nbsp;shader&nbsp;constants&nbsp;based&nbsp;on&nbsp;frequency&nbsp;of&nbsp;state&nbsp;changing,&nbsp;so&nbsp;you&nbsp;might&nbsp;have&nbsp;a&nbsp;per&nbsp;frame&nbsp;UBO/per&nbsp;pass&nbsp;UBO,&nbsp;a&nbsp;material&nbsp;UBO,&nbsp;and&nbsp;a&nbsp;per&nbsp;draw&nbsp;call&nbsp;UBO.&nbsp;(one-off&nbsp;object&nbsp;changes&nbsp;might&nbsp;be&nbsp;the&nbsp;done&nbsp;with&nbsp;the&nbsp;simpler&nbsp;uniform&nbsp;system.)&nbsp;  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Typically&nbsp;that&nbsp;data&nbsp;is&nbsp;not&nbsp;homogeneous,&nbsp;but&nbsp;represented&nbsp;by&nbsp;a&nbsp;C&nbsp;structure&nbsp;that&nbsp;has&nbsp;to&nbsp;be&nbsp;somewhat&nbsp;carefully&nbsp;laid&nbsp;out.&nbsp; &lt;/div&gt;&lt;div&gt;For&nbsp;example&nbsp;I&#39;ve&nbsp;switched&nbsp;to&nbsp;a&nbsp;UBO&nbsp;for&nbsp;OSG&#39;s&nbsp;transform&nbsp;stack:&lt;/div&gt;&lt;div&gt;struct&nbsp;osg_TransformStack&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;{&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; osg::Matrixf&nbsp;ModelViewMatrixInverse;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; osg::Matrixf&nbsp;ModelViewMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; osg::Matrixf&nbsp;ModelViewProjectionMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; osg::Matrixf&nbsp;ProjectionMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; osg::Matrix3&nbsp;NormalMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;};&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;can&nbsp;get&nbsp;mapped&nbsp;to&nbsp;a&nbsp;UBO&nbsp;via &lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; _extensions-&gt;glBufferData(GL_UNIFORM_BUFFER,&nbsp;sizeof(osg_TransformStack),&nbsp;&amp;osg_transformstack,&nbsp;GL_DYNAMIC_DRAW);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;the&nbsp;UBO&nbsp;in&nbsp;glsl&nbsp;would&nbsp;look&nbsp;like:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;struct&nbsp;osg_TransformStack&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;{&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; &nbsp;mat4&nbsp;ModelViewMatrixInverse;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; &nbsp;mat4&nbsp;ModelViewMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; &nbsp;mat4&nbsp;ModelViewProjectionMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; &nbsp;mat4&nbsp;ProjectionMatrix;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; &nbsp;mat3&nbsp;NormalMatrix;&nbsp;//&nbsp;Mat3&#39;s&nbsp;don&#39;t&nbsp;actually&nbsp;map&nbsp;great&nbsp;to&nbsp;std140&nbsp;layouts&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;};&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;layout(std140)&nbsp;uniform&nbsp;osg_transform_stack_block&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;{&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; osg_TransformStack&nbsp;osg;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;};&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Replacing&nbsp;the&nbsp;individual&nbsp;uniforms&nbsp;that&nbsp;OSG&nbsp;adds&nbsp;to&nbsp;replace&nbsp;the&nbsp;legacy&nbsp;gl_*Matrix&nbsp;calls&nbsp;in&nbsp;State::convertVertexShaderSourceToOsgBuiltIns()&nbsp;with&nbsp;a&nbsp;UBO&nbsp;saves&nbsp;me&nbsp;a&nbsp;few&nbsp;ms&nbsp;a&nbsp;frame,&nbsp;but&nbsp;I&#39;m&nbsp;doing&nbsp;all&nbsp;the&nbsp;uniform&nbsp;buffer&nbsp;management&nbsp;by&nbsp;hand&nbsp;and&nbsp;I&#39;ve&nbsp;had&nbsp;to&nbsp;significantly&nbsp;modify&nbsp;the&nbsp;state&nbsp;class.&nbsp;(I&nbsp;think&nbsp;some&nbsp;of&nbsp;the&nbsp;performance&nbsp;gain&nbsp;is&nbsp;from&nbsp;avoiding&nbsp;OSG&#39;s&nbsp;uniform&nbsp;management&nbsp;abstractions&nbsp;as&nbsp;well.)&nbsp; I&#39;ve&nbsp;had&nbsp;to&nbsp;do&nbsp;something&nbsp;similar&nbsp;with&nbsp;materials,&nbsp;otherwise&nbsp;I&nbsp;have&nbsp;significant&nbsp;performance&nbsp;degradation&nbsp;when&nbsp;switching&nbsp;off&nbsp;the&nbsp;fixed&nbsp;function&nbsp;pipeline.&lt;/div&gt;&lt;div&gt; &nbsp;Has&nbsp;anyone&nbsp;else&nbsp;experimented&nbsp;with&nbsp;UBO&#39;s&nbsp;in&nbsp;this&nbsp;manor?&nbsp;Is&nbsp;there&nbsp;a&nbsp;cleaner&nbsp;OSG&nbsp;way&nbsp;to&nbsp;do&nbsp;that&#39;s&nbsp;still&nbsp;high&nbsp;performance?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Gedalia&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
