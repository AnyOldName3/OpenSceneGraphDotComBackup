<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thank&nbsp;you&nbsp;so&nbsp;much&nbsp;for&nbsp;the&nbsp;detailed&nbsp;response&nbsp;Wojtek!&nbsp;I&nbsp;had&nbsp;incorrectly&nbsp;assumed&nbsp;that&nbsp;getOrCreateVertexBufferObject()&nbsp;&quot;assigns&quot;&nbsp;the&nbsp;new&nbsp;VBO&nbsp;to&nbsp;the&nbsp;Geometry,&nbsp;similarly&nbsp;to&nbsp;what&nbsp;happens&nbsp;with&nbsp;getOrCreateStateSet()&nbsp;for&nbsp;a&nbsp;Node.&nbsp;But&nbsp;after&nbsp;reading&nbsp;your&nbsp;response,&nbsp;digging&nbsp;into&nbsp;the&nbsp;OSG&nbsp;code,&nbsp;and&nbsp;reading&nbsp;up&nbsp;more&nbsp;on&nbsp;VBOs,&nbsp;I&nbsp;understand&nbsp;why&nbsp;I&nbsp;was&nbsp;mistaken.&nbsp;A&nbsp;VBO&nbsp;is&nbsp;naturally&nbsp;associated&nbsp;with&nbsp;an&nbsp;array&nbsp;so&nbsp;only&nbsp;gets&nbsp;created&nbsp;when&nbsp;the&nbsp;first&nbsp;array&nbsp;is&nbsp;added&nbsp;to&nbsp;the&nbsp;Geometry.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;moving&nbsp;the&nbsp;setUsage&nbsp;code&nbsp;after&nbsp;array&nbsp;assignment&nbsp;as&nbsp;you&nbsp;suggested,&nbsp;I&nbsp;did&nbsp;see&nbsp;a&nbsp;slight&nbsp;increase&nbsp;in&nbsp;framerate&nbsp;for&nbsp;the&nbsp;batched&nbsp;version,&nbsp;but&nbsp;not&nbsp;up&nbsp;to&nbsp;par&nbsp;with&nbsp;the&nbsp;preallocated&nbsp;version.&nbsp;I&#39;m&nbsp;using&nbsp;an&nbsp;Nvidia&nbsp;GTX&nbsp;980&nbsp;on&nbsp;Windows&nbsp;10.&nbsp;However,&nbsp;it&nbsp;does&nbsp;seem&nbsp;to&nbsp;be&nbsp;a&nbsp;driver&nbsp;issue&nbsp;since&nbsp;memory&nbsp;usage&nbsp;settles&nbsp;down&nbsp;a&nbsp;bit&nbsp;if&nbsp;I&nbsp;leave&nbsp;the&nbsp;application&nbsp;running&nbsp;for&nbsp;a&nbsp;while&nbsp;after&nbsp;all&nbsp;points&nbsp;have&nbsp;been&nbsp;added.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;real&nbsp;lesson&nbsp;I&nbsp;learned&nbsp;here&nbsp;is&nbsp;not&nbsp;to&nbsp;abuse&nbsp;OSG&#39;s&nbsp;automatic&nbsp;VBO&nbsp;management&nbsp;by&nbsp;increasing&nbsp;the&nbsp;buffer&nbsp;in&nbsp;small&nbsp;increments&nbsp;at&nbsp;every&nbsp;frame.&nbsp;In&nbsp;my&nbsp;actual&nbsp;application&nbsp;I&nbsp;run&nbsp;the&nbsp;update&nbsp;callback&nbsp;at&nbsp;a&nbsp;fixed&nbsp;rate&nbsp;and&nbsp;increase&nbsp;the&nbsp;arrays&nbsp;by&nbsp;larger&nbsp;chunks&nbsp;by&nbsp;using&nbsp;resize()&nbsp;instead&nbsp;of&nbsp;repeated&nbsp;push_back&#39;s.&nbsp;This&nbsp;seems&nbsp;to&nbsp;have&nbsp;fully&nbsp;addressed&nbsp;the&nbsp;issue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;again!&lt;/div&gt;&lt;div&gt;Ravi&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;10,&nbsp;2018&nbsp;at&nbsp;8:35&nbsp;AM&nbsp;Wojciech&nbsp;Lewandowski&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:w.p.lewandowski@gmail.com&quot;&gt;w.p.lewandowski@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Ravi,&lt;div&gt;&lt;br&gt;&lt;div&gt;We&nbsp;usually&nbsp;do&nbsp;not&nbsp;make&nbsp;such&nbsp;extensive&nbsp;checks&nbsp;but&nbsp;we&nbsp;were&nbsp;debuging&nbsp;other&nbsp;interesting&nbsp;VBO&nbsp;problem&nbsp;so&nbsp;we&nbsp;also&nbsp;checked&nbsp;yours.&nbsp;Few&nbsp;observations.:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;0.&nbsp;I&nbsp;noticed&nbsp;you&nbsp;used&nbsp;multithreaded&nbsp;configuration&nbsp;and&nbsp;switched&nbsp;to&nbsp;SingleThreaded.&nbsp;Multithreaded&nbsp;config&nbsp;creates&nbsp;2&nbsp;instances&nbsp;of&nbsp;GL&nbsp;resources&nbsp;and&nbsp;I&nbsp;thought&nbsp;it&nbsp;may&nbsp;affect&nbsp;your&nbsp;measurments&nbsp;so&nbsp;we&nbsp;continued&nbsp;with&nbsp;SingleThreaded&nbsp;later. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;Code&nbsp;line&nbsp;where&nbsp;you&nbsp;set&nbsp;DYNAMIC_DRAW&nbsp;is&nbsp;followed&nbsp;by&nbsp;setVertexArray&nbsp;and &nbsp;setVertexArray&nbsp;resets&nbsp;this&nbsp;to&nbsp;STATIC_DRAW.&nbsp;You&nbsp;will&nbsp;get&nbsp;better&nbsp;results&nbsp;when&nbsp;you&nbsp;setUsage&nbsp;after&nbsp;all&nbsp;arrays&nbsp;were&nbsp;defined&nbsp;(like&nbsp;this,&nbsp;note&nbsp;I&nbsp;made&nbsp;numPoints&nbsp;and&nbsp;batchSize&nbsp;global)&nbsp;:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[...]&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp;geom-&gt;setColorArray(lineColors,&nbsp;osg::Array::BIND_OVERALL);&lt;/div&gt;&lt;div&gt; &nbsp;geom-&gt;addPrimitiveSet(new&nbsp;osg::DrawArrays(osg::PrimitiveSet::LINE_STRIP,&nbsp;0,&nbsp;0));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;if&nbsp;(&nbsp;numPoints&nbsp;&gt;&nbsp;batchSize&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;geom-&gt;getOrCreateVertexBufferObject()-&gt;setUsage(GL_DYNAMIC_DRAW);&lt;/div&gt;&lt;div&gt; &nbsp;else&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;geom-&gt;getOrCreateVertexBufferObject()-&gt;setUsage(GL_STATIC_DRAW);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;[...]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;Once&nbsp;we&nbsp;set&nbsp;GL_DYNAMIC_DRAW&nbsp;we&nbsp;see&nbsp;similar&nbsp;performance&nbsp;(on&nbsp;Nvidia&nbsp;GTX&nbsp;1080&nbsp;Windows&nbsp;10)&nbsp;in&nbsp;both&nbsp;versions. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.&nbsp;So&nbsp;in&nbsp;your&nbsp;code&nbsp;the&nbsp;VBO&nbsp;was&nbsp;always&nbsp;refreshed&nbsp;with&nbsp;GL_STATIC_DRAW.&nbsp;We&nbsp;suspect&nbsp;that&nbsp;problem&nbsp;is&nbsp;actually&nbsp;related&nbsp;to&nbsp;OpenGL&nbsp;driver&nbsp;memory&nbsp;management.&nbsp;My&nbsp;friend&nbsp;Marcin&nbsp;Hajder &nbsp;checked&nbsp;the&nbsp;underlying&nbsp;OpenGL&nbsp;calls&nbsp;with&nbsp;CodeXL&nbsp;and&nbsp;both&nbsp;versions&nbsp;made&nbsp;exactly&nbsp;the&nbsp;same&nbsp;calls&nbsp;per&nbsp;frame&nbsp;after&nbsp;updates&nbsp;stopped.&nbsp;And&nbsp;buffer&nbsp;and&nbsp;array&nbsp;sizes&nbsp;were&nbsp;the&nbsp;same&nbsp;too.&nbsp;So&nbsp;we&nbsp;concluded&nbsp;that&nbsp;it&nbsp;must&nbsp;be&nbsp;some&nbsp;memory&nbsp;fragmentation/thrashing&nbsp;issue&nbsp;in&nbsp;OpenGL&nbsp;driver.&nbsp;This&nbsp;suspicion&nbsp;was&nbsp;somewhat&nbsp;confirmed&nbsp;when&nbsp;we&nbsp;checked&nbsp;the&nbsp;memory&nbsp;use.&nbsp;When&nbsp;updates&nbsp;stabilized&nbsp;the&nbsp;dynamic&nbsp;version&nbsp;was&nbsp;still&nbsp;taking&nbsp;10&nbsp;MB&nbsp;more&nbsp;GPU/RAM&nbsp;than&nbsp;static&nbsp;version.&nbsp;See&nbsp;attached&nbsp;screenshots&nbsp;from&nbsp;ProcessExplorer.&nbsp;Picture&nbsp;with&nbsp;larger&nbsp;mem&nbsp;use&nbsp;is&nbsp;dynamic,&nbsp;smaller&nbsp;mem&nbsp;use&nbsp;picter&nbsp;is&nbsp;static&nbsp;version.&nbsp;Note&nbsp;MB&nbsp;usage&nbsp;drop&nbsp;in&nbsp;dynamic&nbsp;version&nbsp;after&nbsp;minute&nbsp;or&nbsp;so&nbsp;from&nbsp;the&nbsp;moment&nbsp;updates&nbsp;stopped.&nbsp;I&nbsp;suspect&nbsp;driver&nbsp;compacted&nbsp;the&nbsp;memory&nbsp;when&nbsp;it&nbsp;noticed&nbsp;the&nbsp;resources&nbsp;are&nbsp;no&nbsp;longer&nbsp;updated.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Hope&nbsp;this&nbsp;helps,&lt;/div&gt;&lt;div&gt;Wojtek&nbsp;Lewandowski&nbsp;&amp;&nbsp;Marcin&nbsp;Hajder&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;czw.,&nbsp;6&nbsp;gru&nbsp;2018&nbsp;o&nbsp;21:36 Ravi&nbsp;Mathur&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ravidavi@utexas.edu&quot;&nbsp;target=&quot;_blank&quot;&gt;ravidavi@utexas.edu&lt;/a&gt;&gt;&nbsp;napisał(a):&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;running&nbsp;into&nbsp;a&nbsp;strange&nbsp;performance&nbsp;drop&nbsp;issue&nbsp;when&nbsp;using&nbsp;dynamic&nbsp;VBOs&nbsp;that&nbsp;change&nbsp;frequently.&nbsp;I&nbsp;am&nbsp;measuring&nbsp;performance&nbsp;using&nbsp;framerate&nbsp;with&nbsp;vsync&nbsp;turned&nbsp;off.&nbsp;I&nbsp;know&nbsp;that&nbsp;framerate&nbsp;isn&#39;t&nbsp;always&nbsp;the&nbsp;best&nbsp;performance&nbsp;measurement,&nbsp;but&nbsp;my&nbsp;example&nbsp;is&nbsp;simple&nbsp;enough&nbsp;and&nbsp;the&nbsp;performance&nbsp;drop&nbsp;is&nbsp;significant&nbsp;and&nbsp;repeatable,&nbsp;so&nbsp;I&nbsp;feel&nbsp;comfortable&nbsp;using&nbsp;framerate. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;issue:&nbsp;Suppose&nbsp;I&nbsp;have&nbsp;a&nbsp;Geometry&nbsp;that&nbsp;will&nbsp;hold&nbsp;lots&nbsp;of&nbsp;points&nbsp;(e.g.&nbsp;100k&nbsp;or&nbsp;more).&nbsp;If&nbsp;I&nbsp;choose&nbsp;to&nbsp;pre-define&nbsp;all&nbsp;points&nbsp;in&nbsp;its&nbsp;vertex&nbsp;array,&nbsp;then&nbsp;a&nbsp;certain&nbsp;framerate&nbsp;is&nbsp;achieved.&nbsp;However,&nbsp;if&nbsp;I&nbsp;choose&nbsp;to&nbsp;add&nbsp;a&nbsp;batch&nbsp;of&nbsp;points&nbsp;during&nbsp;each&nbsp;update&nbsp;traversal,&nbsp;up&nbsp;to&nbsp;the&nbsp;same&nbsp;total&nbsp;number&nbsp;of&nbsp;points,&nbsp;then&nbsp;after&nbsp;all&nbsp;points&nbsp;have&nbsp;been&nbsp;added&nbsp;the&nbsp;framerate&nbsp;is&nbsp;much&nbsp;lower&nbsp;than&nbsp;in&nbsp;the&nbsp;pre-defined&nbsp;model.&nbsp;Note&nbsp;that&nbsp;&quot;much&nbsp;lower&quot;&nbsp;means&nbsp;over&nbsp;30%&nbsp;lower.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Note&nbsp;that&nbsp;in&nbsp;both&nbsp;cases,&nbsp;the&nbsp;same&nbsp;number&nbsp;of&nbsp;points&nbsp;are&nbsp;being&nbsp;drawn,&nbsp;and&nbsp;the&nbsp;Geometry&nbsp;and&nbsp;its&nbsp;vertex&nbsp;array&nbsp;are&nbsp;created&nbsp;once&nbsp;and&nbsp;modified&nbsp;(I&#39;m&nbsp;not&nbsp;creating&nbsp;new&nbsp;Geometry&nbsp;objects&nbsp;at&nbsp;every&nbsp;update).&nbsp;All&nbsp;that&nbsp;changes&nbsp;is&nbsp;whether&nbsp;I&nbsp;added&nbsp;the&nbsp;points&nbsp;all&nbsp;at&nbsp;once&nbsp;before&nbsp;rendering&nbsp;or&nbsp;a&nbsp;few&nbsp;at&nbsp;a&nbsp;time&nbsp;while&nbsp;rendering.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;wrote&nbsp;a&nbsp;small&nbsp;standalone&nbsp;osg&nbsp;example&nbsp;(attached).&nbsp;Compile,&nbsp;run,&nbsp;and&nbsp;show&nbsp;stats&nbsp;using:&lt;/div&gt;&lt;div&gt;&gt; .\osgdynamicvbotest.exe&nbsp;--numPoints&nbsp;100000&nbsp;--batchSize&nbsp;100000&lt;/div&gt;&lt;div&gt; &nbsp; *&nbsp;If&nbsp;batchSize&nbsp;=&nbsp;100000&nbsp;(same&nbsp;as&nbsp;numPoints)&nbsp;then&nbsp;you&#39;ll&nbsp;see&nbsp;the&nbsp;case&nbsp;where&nbsp;all&nbsp;points&nbsp;are&nbsp;pre-defined.&lt;/div&gt;&lt;div&gt; &nbsp; *&nbsp;As&nbsp;you&nbsp;reduce&nbsp;batchSize&nbsp;(e.g.&nbsp;100),&nbsp;it&nbsp;will&nbsp;take&nbsp;longer&nbsp;to&nbsp;add&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;points,&nbsp;but&nbsp;after&nbsp;all&nbsp;points&nbsp;have&nbsp;been&nbsp;added&nbsp;and&nbsp;the&nbsp;framerate&nbsp;stabilizes,&nbsp;you&#39;ll&nbsp;see&nbsp;it&nbsp;is&nbsp;much&nbsp;lower&nbsp;than&nbsp;the&nbsp;pre-defined&nbsp;case&nbsp;above.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;question&nbsp;is,&nbsp;why&nbsp;is&nbsp;this&nbsp;happening?&nbsp;Is&nbsp;it&nbsp;related&nbsp;to&nbsp;intermediate&nbsp;VBOs&nbsp;being&nbsp;kept&nbsp;in&nbsp;memory&nbsp;and&nbsp;slowing&nbsp;down&nbsp;the&nbsp;GPU?&nbsp;All&nbsp;the&nbsp;other&nbsp;forum&nbsp;posts&nbsp;I&nbsp;see&nbsp;on&nbsp;the&nbsp;topic&nbsp;are&nbsp;either&nbsp;about&nbsp;VBOs&nbsp;not&nbsp;displaying&nbsp;properly&nbsp;(not&nbsp;the&nbsp;case&nbsp;here)&nbsp;or&nbsp;about&nbsp;memory&nbsp;usage&nbsp;(not&nbsp;the&nbsp;case&nbsp;here). &lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;thoughts&nbsp;on&nbsp;what&#39;s&nbsp;going&nbsp;on&nbsp;here&nbsp;would&nbsp;be&nbsp;very&nbsp;much&nbsp;appreciated.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you!&lt;/div&gt;&lt;div&gt;Ravi&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&nbsp;target=&quot;_blank&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&nbsp;target=&quot;_blank&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
