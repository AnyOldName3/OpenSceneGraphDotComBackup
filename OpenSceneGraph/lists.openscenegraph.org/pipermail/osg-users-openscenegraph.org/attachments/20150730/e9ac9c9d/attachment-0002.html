<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Christian,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Dealing&nbsp;with&nbsp;the&nbsp;GC&nbsp;in&nbsp;Java&nbsp;is&nbsp;always&nbsp;a&nbsp;pain.&nbsp;Some&nbsp;time&nbsp;ago&nbsp;I&nbsp;worked&nbsp;doing&nbsp;some&nbsp;JNI&nbsp;libraries&nbsp;with&nbsp;OSG&nbsp;and&nbsp;we&nbsp;had&nbsp;problems&nbsp;with&nbsp;the&nbsp;GC&nbsp;don&#39;t&nbsp;freeing&nbsp;&quot;small&quot;&nbsp;objects&nbsp;in&nbsp;Java&nbsp;(wrappers&nbsp;for&nbsp;big&nbsp;C++&nbsp;objects).&nbsp;In&nbsp;the&nbsp;end&nbsp;the&nbsp;more&nbsp;you&nbsp;can&nbsp;do&nbsp;in&nbsp;the&nbsp;native&nbsp;part&nbsp;the&nbsp;better&nbsp;if&nbsp;you&nbsp;need&nbsp;performance&nbsp;and&nbsp;an&nbsp;strict&nbsp;memory&nbsp;control.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;android&nbsp;I&nbsp;recommend&nbsp;you&nbsp;take&nbsp;a&nbsp;look&nbsp;to&nbsp;the&nbsp;osgjni&nbsp;sample: &lt;a&nbsp;href=&quot;https://github.com/miragetech/osgAndroid/tree/master/org.openscenegraph.osgjni&quot;&gt;https://github.com/miragetech/osgAndroid/tree/master/org.openscenegraph.osgjni&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;purpose&nbsp;of&nbsp;this&nbsp;sample&nbsp;was&nbsp;making&nbsp;&quot;complex&quot;&nbsp; things&nbsp;that&nbsp;were&nbsp;not&nbsp;supported&nbsp;in&nbsp;the&nbsp;JNI&nbsp;wrapper.&nbsp;As&nbsp;you&nbsp;can&nbsp;see&nbsp;in&nbsp;the&nbsp;Activity:&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&nbsp;Node&nbsp;node&nbsp;=&nbsp;ReadFile.readNodeFile(path);&lt;br&gt;&nbsp;MatrixTransform&nbsp;m&nbsp;=&nbsp;new&nbsp;MatrixTransform();&lt;br&gt;&nbsp;m.addChild(node);&lt;br&gt;&nbsp;mView.setSceneData(OSGConfiguration.configureScene(m));&lt;br&gt;&lt;br&gt;The&nbsp;osgAndroid&nbsp;library&nbsp;is&nbsp;used&nbsp;for&nbsp;loading&nbsp;a&nbsp;node&nbsp;but&nbsp;then&nbsp;before&nbsp;setting&nbsp;the&nbsp;scene&nbsp;to&nbsp;the&nbsp;viewer&nbsp;I&nbsp;call&nbsp;to&nbsp;a&nbsp;&quot;OSGConfiguration&quot;&nbsp;class&nbsp;that&nbsp;is&nbsp;another&nbsp;JNI&nbsp;wrapper&nbsp;in&nbsp;the&nbsp;current&nbsp;project:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;a&nbsp;href=&quot;https://github.com/miragetech/osgAndroid/blob/master/org.openscenegraph.osgjni/src/org/openscenegraph/osgjni/OSGConfiguration.java&quot;&gt;https://github.com/miragetech/osgAndroid/blob/master/org.openscenegraph.osgjni/src/org/openscenegraph/osgjni/OSGConfiguration.java&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/miragetech/osgAndroid/blob/master/org.openscenegraph.osgjni/jni/JNIOSGConfiguration.cpp&quot;&gt;https://github.com/miragetech/osgAndroid/blob/master/org.openscenegraph.osgjni/jni/JNIOSGConfiguration.cpp&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;creates&nbsp;a&nbsp;simple&nbsp;animation&nbsp;with&nbsp;OSG&nbsp;in&nbsp;the&nbsp;native&nbsp;part,&nbsp;I&nbsp;think&nbsp;a&nbsp;similar&nbsp;approach&nbsp;could&nbsp;be&nbsp;used&nbsp;for&nbsp;you,&nbsp;avoiding&nbsp;all&nbsp;the&nbsp;GC&nbsp;thing.&nbsp;You&nbsp;can&nbsp;also&nbsp;create&nbsp;new&nbsp;wrappers&nbsp;of&nbsp;your&nbsp;own&nbsp;classes&nbsp;following&nbsp;the&nbsp;same&nbsp;schema&nbsp;used&nbsp;in&nbsp;osgAndroid&nbsp;if&nbsp;you&nbsp;think&nbsp;it&nbsp;could&nbsp;be&nbsp;useful&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;it&nbsp;helps!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Rafa&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;El&nbsp;jue.,&nbsp;30&nbsp;jul.&nbsp;2015&nbsp;a&nbsp;las&nbsp;20:35,&nbsp;Christian&nbsp;Kehl&nbsp;(&lt;&lt;a&nbsp;href=&quot;mailto:christian-kehl@web.de&quot;&gt;christian-kehl@web.de&lt;/a&gt;&gt;)&nbsp;escribió:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;to&nbsp;everyone,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;currently&nbsp;extend&nbsp;the&nbsp;osgAndroid&nbsp;project&nbsp;(attempt)&nbsp;to&nbsp;do&nbsp;Texture&nbsp;Projection&nbsp;and&nbsp;Mapping&nbsp;with&nbsp;mobile&nbsp;images.&nbsp;I&nbsp;already&nbsp;extended&nbsp;the&nbsp;codebase&nbsp;so&nbsp;to&nbsp;get&nbsp;access&nbsp;to&nbsp;the&nbsp;geometry,&nbsp;Vector&nbsp;Arrays&nbsp;etc.&nbsp;of&nbsp;a&nbsp;loaded&nbsp;geometry.&nbsp;Now,&nbsp;the&nbsp;geometry&nbsp;loading&nbsp;function&nbsp;looks&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Code:&lt;br&gt;<br>
&lt;br&gt;<br>
private&nbsp;void&nbsp;_load_geometry()&lt;br&gt;<br>
{&lt;br&gt;<br>
 &nbsp;Node&nbsp;mesh_node&nbsp;=&nbsp;ReadFile.readNodeFile(pointcloud_path);&lt;br&gt;<br>
 &nbsp;mesh&nbsp;=&nbsp;new&nbsp;Group(mesh_node.getNativePtr());&lt;br&gt;<br>
 &nbsp;Geode&nbsp;mesh_geode&nbsp;=&nbsp;new&nbsp;Geode(mesh.getLastChild().getNativePtr());&lt;br&gt;<br>
 &nbsp;_drawable&nbsp;=&nbsp;new&nbsp;Geometry(mesh_geode.getLastDrawable().getNativePtr());&lt;br&gt;<br>
 &nbsp;vertex_array&nbsp;=&nbsp;_drawable.getVertexArray();&lt;br&gt;<br>
 &nbsp;Log.i(&quot;TEXTUREMAPPING&quot;,&nbsp;&quot;Vertex&nbsp;array&nbsp;loaded&quot;);&lt;br&gt;<br>
 &nbsp;geometry&nbsp;=&nbsp;new&nbsp;ArrayList&lt;Point3&gt;();&lt;br&gt;<br>
 &nbsp;Log.i(&quot;TEXTUREMAPPING&quot;,&nbsp;&quot;Geometry&nbsp;allocated&quot;);&lt;br&gt;<br>
 &nbsp;for(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;vertex_array.size();&nbsp;i++)&lt;br&gt;<br>
 &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp;geometry.add(new&nbsp;Point3(vertex_array.get(i).x(),&nbsp;vertex_array.get(i).y(),&nbsp;vertex_array.get(i).z()));&lt;br&gt;<br>
 &nbsp;}&lt;br&gt;<br>
 &nbsp;Log.i(&quot;TEXTUREMAPPING&quot;,&nbsp;&quot;Geometry&nbsp;set.&quot;);&lt;br&gt;<br>
 &nbsp;geometry_as_matrix&nbsp;=&nbsp;new&nbsp;MatOfPoint3f();&lt;br&gt;<br>
 &nbsp;Log.i(&quot;TEXTUREMAPPING&quot;,&nbsp;&quot;Number&nbsp;of&nbsp;3D&nbsp;points:&nbsp;&quot;&nbsp;+&nbsp;Integer.toString(geometry.size()));&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;geometry&quot;&nbsp;is&nbsp;here&nbsp;an&nbsp;ArrayList&nbsp;of&nbsp;OpenCV&#39;s&nbsp;Point3.&nbsp;As&nbsp;you&nbsp;can&nbsp;see,&nbsp;In&nbsp;the&nbsp;for-loop&nbsp;I&nbsp;touch&nbsp;every&nbsp;element&nbsp;in&nbsp;the&nbsp;Vec3Array.&nbsp;The&nbsp;Vec3Array&nbsp;itself&nbsp;is&nbsp;a&nbsp;wrapped&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C++&nbsp;class,&nbsp;accessed&nbsp;with&nbsp;its&nbsp;object&nbsp;pointer,&nbsp;as&nbsp;seen&nbsp;in&nbsp;this&nbsp;JNI&nbsp;wrapper&nbsp;code:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Code:&lt;br&gt;<br>
&lt;br&gt;<br>
JNIEXPORT&nbsp;jlong&nbsp;JNICALL&nbsp;Java_org_openscenegraph_osg_core_Vec3Array_nativeCreateVec3Array(JNIEnv&nbsp;*,&nbsp;jclass)&lt;br&gt;<br>
{&lt;br&gt;<br>
 &nbsp;osg::Vec3Array&nbsp;*a&nbsp;=&nbsp;new&nbsp;osg::Vec3Array();&lt;br&gt;<br>
 &nbsp;a-&gt;ref();&lt;br&gt;<br>
 &nbsp;return&nbsp;reinterpret_cast&lt;jlong&gt;(a);&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Now,&nbsp;the&nbsp;trouble:&nbsp;with&nbsp;a&nbsp;certain&nbsp;geometry&nbsp;(test:40k&nbsp;vertices),&nbsp;the&nbsp;test&nbsp;message&nbsp;of&nbsp;actually&nbsp;accessed&nbsp;elements&nbsp;[&quot;Number&nbsp;of&nbsp;3D&nbsp;Points:&quot;&nbsp;geometry.size(),&nbsp;see&nbsp;above]&nbsp;prints&nbsp;~11k&nbsp;vertices.&nbsp;In&nbsp;the&nbsp;java&nbsp;console&nbsp;logs&nbsp;(LogCat),&nbsp;I&nbsp;see&nbsp;that&nbsp;Java&#39;s&nbsp;GC&nbsp;&quot;cleared&quot;&nbsp;its&nbsp;memory&nbsp;two&nbsp;times&nbsp;during&nbsp;the&nbsp;upper&nbsp;function&nbsp;execution.&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;question:&nbsp;How&nbsp;can&nbsp;I&nbsp;avoid&nbsp;it&nbsp;?&nbsp;How&nbsp;can/should&nbsp;I&nbsp;do&nbsp;the&nbsp;per-Vertex&nbsp;operations&nbsp;?&nbsp;Has&nbsp;anybody&nbsp;encountered&nbsp;problems&nbsp;with&nbsp;Java&#39;s&nbsp;GC&nbsp;formerly,&nbsp;either&nbsp;in&nbsp;former&nbsp;Android&nbsp;wrappers&nbsp;or&nbsp;in&nbsp;old&nbsp;Java&nbsp;platform&nbsp;portations&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;internet&nbsp;with&nbsp;several&nbsp;blogs&nbsp;and&nbsp;lectures&nbsp;tells&nbsp;me&nbsp;there&nbsp;is&nbsp;(especially&nbsp;with&nbsp;Android)&nbsp;no&nbsp;way&nbsp;to&nbsp;actually&nbsp;&quot;control&quot;&nbsp;the&nbsp;GC,&nbsp;or&nbsp;protect&nbsp;certain&nbsp;objects&nbsp;from&nbsp;not&nbsp;being&nbsp;freed.&nbsp;The&nbsp;only&nbsp;option&nbsp;mentioned&nbsp;is&nbsp;to&nbsp;code&nbsp;the&nbsp;things&nbsp;in&nbsp;JNI&nbsp;(C++),&nbsp;as&nbsp;the&nbsp;Garbage&nbsp;Collector&nbsp;obviously&nbsp;doesn&#39;t&nbsp;operate&nbsp;on&nbsp;the&nbsp;C++&nbsp;code.&lt;br&gt;<br>
&lt;br&gt;<br>
Opinions&nbsp;and&nbsp;suggestions&nbsp;are&nbsp;welcome.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Christian&lt;br&gt;<br>
&lt;br&gt;<br>
------------------&lt;br&gt;<br>
Read&nbsp;this&nbsp;topic&nbsp;online&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://forum.openscenegraph.org/viewtopic.php?p=64536#64536&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forum.openscenegraph.org/viewtopic.php?p=64536#64536&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&nbsp;target=&quot;_blank&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
