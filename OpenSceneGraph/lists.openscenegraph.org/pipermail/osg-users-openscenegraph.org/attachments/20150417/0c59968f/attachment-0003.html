<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Apr&nbsp;17,&nbsp;2015&nbsp;at&nbsp;1:57&nbsp;PM,&nbsp;Björn&nbsp;Blissing&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:bjorn.blissing@vti.se&quot;&nbsp;target=&quot;_blank&quot;&gt;bjorn.blissing@vti.se&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Looking&nbsp;at&nbsp;this&nbsp;plot&nbsp;it&nbsp;seems&nbsp;like&nbsp;the&nbsp;latency&nbsp;times&nbsp;are&nbsp;varying&nbsp;according&nbsp;to&nbsp;a&nbsp;pattern.&nbsp;My&nbsp;guess&nbsp;is&nbsp;that&nbsp;the&nbsp;screen&nbsp;runs&nbsp;asynchronously&nbsp;with&nbsp;the&nbsp;GPU.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;it&nbsp;certainly&nbsp;does.&nbsp;Modern&nbsp;LCDs&nbsp;are&nbsp;not&nbsp;tied&nbsp;to&nbsp;the&nbsp;VSYNC/HSYNC&nbsp;and&nbsp;pixel&nbsp;clock&nbsp;signals&nbsp;anymore&nbsp;as&nbsp;the&nbsp;old&nbsp;CRTs&nbsp;were,&nbsp;because&nbsp;there&nbsp;is&nbsp;always&nbsp;an&nbsp;image&nbsp;processing&nbsp;logic&nbsp;inbetween.&nbsp;If&nbsp;for&nbsp;nothing&nbsp;else&nbsp;then&nbsp;for&nbsp;scaling&nbsp;the&nbsp;image&nbsp;to&nbsp;the&nbsp;full&nbsp;resolution&nbsp;of&nbsp;the&nbsp;LCD&nbsp;panel.&nbsp;With&nbsp;packet&nbsp;oriented&nbsp;digital&nbsp;connections&nbsp;like&nbsp;DisplayPort&nbsp;it&nbsp;gets&nbsp;decoupled&nbsp;even&nbsp;further&nbsp;(DVI/HDMI&nbsp;is&nbsp;still&nbsp;essentially&nbsp;emulating&nbsp;the&nbsp;old&nbsp;VGA&nbsp;which&nbsp;in&nbsp;turns&nbsp;emulates&nbsp;the&nbsp;old&nbsp;TV&nbsp;conventions&nbsp;for&nbsp;video,&nbsp;even&nbsp;though&nbsp;the&nbsp;way&nbsp;the&nbsp;signals&nbsp;are&nbsp;encoded&nbsp;electrically&nbsp;is&nbsp;very&nbsp;different).&nbsp;Oh&nbsp;and&nbsp;it&nbsp;gets&nbsp;better&nbsp;-&nbsp;in&nbsp;fact,&nbsp;some&nbsp;monitors&nbsp;completely&nbsp;ignore&nbsp;<br>
VSYNC/HSYNC&nbsp;signals&nbsp;when&nbsp;connected&nbsp;by&nbsp;a&nbsp;digital&nbsp;connection&nbsp;<br>
(HDMI/DisplayPort),&nbsp;because&nbsp;they&nbsp;know&nbsp;how&nbsp;many&nbsp;pixels&nbsp;they&nbsp;need&nbsp;to&nbsp;draw,<br>
&nbsp;so&nbsp;they&nbsp;simply&nbsp;count&nbsp;the&nbsp;incoming&nbsp;bytes,&nbsp;something&nbsp;that&nbsp;was&nbsp;not&nbsp;possible&nbsp;with&nbsp;the&nbsp;purely&nbsp;analog&nbsp;VGA&nbsp;signals&nbsp;and&nbsp;analog&nbsp;monitors.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;are&nbsp;basically&nbsp;4&nbsp;completely&nbsp;asynchronous&nbsp;systems&nbsp;here:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;your&nbsp;code&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;the&nbsp;GPU&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;the&nbsp;monitor&nbsp;processor&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;the&nbsp;LCD&nbsp;panel&nbsp;itself&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;first&nbsp;two&nbsp;can&nbsp;be&nbsp;synchronized&nbsp;using&nbsp;VSYNC&nbsp;and/or&nbsp;fences,&nbsp;the&nbsp;second&nbsp;two&nbsp;using&nbsp;the&nbsp;HDMI/DVI/VGA&nbsp;electrical&nbsp;signals,&nbsp;the&nbsp;monitor&nbsp;processor&nbsp;is&nbsp;synchronized&nbsp;with&nbsp;the&nbsp;LCD&nbsp;panel,&nbsp;but&nbsp;there&nbsp;is&nbsp;no&nbsp;mutual&nbsp;synchronisation&nbsp;between&nbsp;these&nbsp;pairs,&nbsp;there&nbsp;are,&nbsp;in&nbsp;fact,&nbsp;buffers&nbsp;between&nbsp;them&nbsp;to&nbsp;account&nbsp;for&nbsp;the&nbsp;differing&nbsp;processing&nbsp;speeds.&nbsp;And&nbsp;you&nbsp;can&nbsp;typically&nbsp;only&nbsp;observe&nbsp;the&nbsp;first&nbsp;and&nbsp;the&nbsp;last&nbsp;one&nbsp;...&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&nbsp;So&nbsp;the&nbsp;screen&nbsp;polls&nbsp;the&nbsp;GPU&nbsp;at&nbsp;60Hz&nbsp;and&nbsp;sometimes&nbsp;the&nbsp;GPU&nbsp;just&nbsp;happens&nbsp;to&nbsp;have&nbsp;a&nbsp;frame&nbsp;ready&nbsp;when&nbsp;the&nbsp;screen&nbsp;starts&nbsp;a&nbsp;scanout.&nbsp;&lt;/blockquote&gt;&lt;div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;The<br>
&nbsp;lower&nbsp;limit&nbsp;is&nbsp;just&nbsp;the&nbsp;pure&nbsp;scanout&nbsp;time&nbsp;of&nbsp;the&nbsp;display.&nbsp;But&nbsp;this&nbsp;is&nbsp;<br>
just&nbsp;my&nbsp;theory&nbsp;right&nbsp;now.&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;the&nbsp;detailed&nbsp;knowledge&nbsp;of&nbsp;the&nbsp;<br>
inner&nbsp;workings&nbsp;of&nbsp;a&nbsp;LCD&nbsp;display.&lt;/blockquote&gt; &lt;/div&gt;&lt;div&gt;The&nbsp;way&nbsp;it&nbsp;works&nbsp;is&nbsp;the&nbsp;opposite&nbsp;-&nbsp;the&nbsp;GPU&nbsp;generates&nbsp;the&nbsp;data&nbsp;at&nbsp;whatever&nbsp;resolution&nbsp;and&nbsp;refresh&nbsp;rate&nbsp;the&nbsp;screen&nbsp;declares&nbsp;that&nbsp;it&nbsp;supports&nbsp;(determined&nbsp;via&nbsp;EDID,&nbsp;unless&nbsp;manually&nbsp;overriden&nbsp;in&nbsp;the&nbsp;driver&nbsp;settings)&nbsp;and&nbsp;sends&nbsp;these&nbsp;to&nbsp;the&nbsp;processor&nbsp;in&nbsp;the&nbsp;display.&nbsp;The&nbsp;display&nbsp;then&nbsp;does&nbsp;any&nbsp;processing&nbsp;it&nbsp;needs&nbsp;and&nbsp;only&nbsp;actually&nbsp;flips&nbsp;the&nbsp;pixels&nbsp;on&nbsp;the&nbsp;panel&nbsp;when&nbsp;ready,&nbsp;independently&nbsp;from&nbsp;the&nbsp;GPU.&nbsp;Which&nbsp;is&nbsp;always&nbsp;delayed&nbsp;a&nbsp;bit&nbsp;-&nbsp;depending&nbsp;on&nbsp;how&nbsp;much&nbsp;processing&nbsp;the&nbsp;display&nbsp;does.&nbsp;There&nbsp;is&nbsp;no&nbsp;polling,&nbsp;the&nbsp;video&nbsp;connection&nbsp;is&nbsp;essentially&nbsp;one&nbsp;way&nbsp;only&nbsp;(not&nbsp;counting&nbsp;service&nbsp;data&nbsp;like&nbsp;EDID).&nbsp;&lt;br&gt;&lt;br&gt;In&nbsp;comparison,&nbsp;the&nbsp;old&nbsp;CRTs&nbsp;had&nbsp;low&nbsp;latency,&nbsp;because&nbsp;the&nbsp;analog&nbsp;signal&nbsp;from&nbsp;the&nbsp;GPU&nbsp;was&nbsp;driving&nbsp;the&nbsp;deflection&nbsp;coils&nbsp;steering&nbsp;the&nbsp;electron&nbsp;beam&nbsp;practically&nbsp;directly,&nbsp;with&nbsp;no&nbsp;buffering&nbsp;or&nbsp;processing.&nbsp;When&nbsp;the&nbsp;GPU&nbsp;started&nbsp;a&nbsp;new&nbsp;frame&nbsp;by&nbsp;sending&nbsp;VSYNC,&nbsp;the&nbsp;monitor&nbsp;really&nbsp;made&nbsp;the&nbsp;beam&nbsp;jump&nbsp;to&nbsp;the&nbsp;upper&nbsp;left&nbsp;corner&nbsp;at&nbsp;that&nbsp;moment.&nbsp;That&nbsp;also&nbsp;explains&nbsp;why&nbsp;you&nbsp;could&nbsp;generate&nbsp;&quot;weird&quot;,&nbsp;unsupported&nbsp;resolutions&nbsp;out&nbsp;of&nbsp;an&nbsp;analog&nbsp;CRT&nbsp;screen&nbsp;and&nbsp;why&nbsp;you&nbsp;could&nbsp;potentially&nbsp;fry&nbsp;it&nbsp;with&nbsp;resolution&nbsp;or&nbsp;refresh&nbsp;too&nbsp;high&nbsp;for&nbsp;it&nbsp;to&nbsp;handle&nbsp;-&nbsp;the&nbsp;deflection&nbsp;coild&nbsp;electronics&nbsp;would&nbsp;typically&nbsp;overheat,&nbsp;drawing&nbsp;too&nbsp;much&nbsp;current.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;the&nbsp;problem&nbsp;you&nbsp;are&nbsp;seeing&nbsp;with&nbsp;the&nbsp;&quot;jitter&quot;&nbsp;that&nbsp;sometimes&nbsp;you&nbsp;have&nbsp;very&nbsp;low&nbsp;latency&nbsp;and&nbsp;sometimes&nbsp;it&nbsp;is&nbsp;over&nbsp;a&nbsp;frame&nbsp;comes&nbsp;from&nbsp;a&nbsp;different&nbsp;source&nbsp;-&nbsp;namely&nbsp;your&nbsp;program&nbsp;and&nbsp;the&nbsp;VSYNC&nbsp;handling&nbsp;by&nbsp;the&nbsp;GPU.&nbsp;The&nbsp;GPU&nbsp;will&nbsp;always&nbsp;generate&nbsp;the&nbsp;output&nbsp;signal&nbsp;the&nbsp;same&nbsp;way,&nbsp;VSYNC&nbsp;or&nbsp;no&nbsp;VSYNC,&nbsp;otherwise&nbsp;the&nbsp;monitor&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;handle&nbsp;it&nbsp;and&nbsp;sync&nbsp;to&nbsp;it.&nbsp;What&nbsp;happens&nbsp;is&nbsp;that&nbsp;sometimes&nbsp;your&nbsp;program&nbsp;&quot;gets&nbsp;lucky&quot;&nbsp;and&nbsp;tells&nbsp;the&nbsp;GPU&nbsp;to&nbsp;swap&nbsp;buffers&nbsp;&quot;just&nbsp;in&nbsp;time&quot;&nbsp;before&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;next&nbsp;frame&nbsp;-&nbsp;then&nbsp;you&nbsp;have&nbsp;very&nbsp;little&nbsp;latency,&nbsp;because&nbsp;the&nbsp;change&nbsp;gets&nbsp;visible&nbsp;almost&nbsp;immediately&nbsp;(modulo&nbsp;the&nbsp;input&nbsp;latency&nbsp;of&nbsp;the&nbsp;monitor&nbsp;above).&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;sometimes&nbsp;you&nbsp;get&nbsp;unlucky,&nbsp;you&nbsp;swap&nbsp;buffers&nbsp;right&nbsp;after&nbsp;the&nbsp;scanout&nbsp;of&nbsp;the&nbsp;framebuffer&nbsp;has&nbsp;started&nbsp;and&nbsp;then&nbsp;the&nbsp;GPU&nbsp;will&nbsp;hold&nbsp;your&nbsp;image&nbsp;until&nbsp;the&nbsp;next&nbsp;frame&nbsp;cycle&nbsp;-&nbsp;poof,&nbsp;one&nbsp;frame&nbsp;of&nbsp;latency&nbsp;extra&nbsp;...&nbsp;And&nbsp;you&nbsp;can&nbsp;have&nbsp;everything&nbsp;in&nbsp;between&nbsp;these&nbsp;two&nbsp;extreme&nbsp;cases.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;VSYNC&nbsp;is&nbsp;on,&nbsp;it&nbsp;gets&nbsp;even&nbsp;more&nbsp;complicated,&nbsp;because&nbsp;then&nbsp;you&nbsp;are&nbsp;telling&nbsp;the&nbsp;GPU&nbsp;to&nbsp;synchronize&nbsp;the&nbsp;userspace&nbsp;code&nbsp;with&nbsp;the&nbsp;frame&nbsp;scanout&nbsp;start&nbsp;(not&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;physical&nbsp;frame&nbsp;on&nbsp;the&nbsp;monitor&nbsp;when&nbsp;your&nbsp;sensor&nbsp;reacts&nbsp;-&nbsp;remember,&nbsp;the&nbsp;GPU&nbsp;has&nbsp;no&nbsp;control&nbsp;at&nbsp;all&nbsp;over&nbsp;the&nbsp;image&nbsp;processor&nbsp;in&nbsp;the&nbsp;monitor!).&nbsp;This&nbsp;is&nbsp;typically&nbsp;an&nbsp;extremely&nbsp;inefficient&nbsp;thing&nbsp;to&nbsp;do&nbsp;from&nbsp;the&nbsp;driver&#39;s&nbsp;point&nbsp;of&nbsp;view&nbsp;because&nbsp;you&nbsp;are&nbsp;stalling&nbsp;the&nbsp;GPU&nbsp;until&nbsp;the&nbsp;new&nbsp;frame&nbsp;is&nbsp;due,&nbsp;so&nbsp;the&nbsp;drivers&nbsp;often&nbsp;&quot;play&nbsp;games&quot;&nbsp;here&nbsp;-&nbsp;like&nbsp;not&nbsp;really&nbsp;blocking&nbsp;your&nbsp;program&nbsp;waiting&nbsp;for&nbsp;the&nbsp;frame&nbsp;start&nbsp;but&nbsp;return&nbsp;right&nbsp;away&nbsp;and&nbsp;buffer&nbsp;your&nbsp;frame&nbsp;internally.&nbsp;The&nbsp;frame&nbsp;then&nbsp;gets&nbsp;sent&nbsp;out&nbsp;later&nbsp;when&nbsp;convenient&nbsp;(i.e.&nbsp;on&nbsp;the&nbsp;next&nbsp;scanout&nbsp;cycle).&nbsp;They&nbsp;can&nbsp;even&nbsp;hold&nbsp;several&nbsp;frames&nbsp;back&nbsp;like&nbsp;that&nbsp;and&nbsp;block&nbsp;only&nbsp;when&nbsp;this&nbsp;frame&nbsp;queue&nbsp;runs&nbsp;out&nbsp;of&nbsp;space&nbsp;(you&nbsp;were&nbsp;really&nbsp;rendering&nbsp;too&nbsp;fast).&nbsp;Especially&nbsp;Nvidia&nbsp;is&nbsp;known&nbsp;for&nbsp;these&nbsp;VSYNC&nbsp;&quot;shenanigans&quot;&nbsp;in&nbsp;their&nbsp;driver.&nbsp;This&nbsp;is&nbsp;what&nbsp;Robert&nbsp;was&nbsp;talking&nbsp;about&nbsp;with&nbsp;the&nbsp;fences&nbsp;-&nbsp;that&nbsp;is&nbsp;a&nbsp;relatively&nbsp;recent&nbsp;feature&nbsp;that&nbsp;allows&nbsp;you&nbsp;to&nbsp;force&nbsp;the&nbsp;driver&nbsp;to&nbsp;wait&nbsp;until&nbsp;a&nbsp;certain&nbsp;event&nbsp;occurs&nbsp;-&nbsp;e.g.&nbsp;a&nbsp;new&nbsp;frame&nbsp;start&nbsp;or&nbsp;sync&nbsp;event&nbsp;from&nbsp;an&nbsp;external&nbsp;source&nbsp;(e.g.&nbsp;genlock).&nbsp;The&nbsp;regular&nbsp;VSYNC&nbsp;ON/OFF&nbsp;will&nbsp;not&nbsp;guarantee&nbsp;this&nbsp;anymore&nbsp;on&nbsp;today&#39;s&nbsp;hardware,&nbsp;it&nbsp;only&nbsp;guarantees&nbsp;that&nbsp;you&nbsp;will&nbsp;not&nbsp;change&nbsp;the&nbsp;framebuffer&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;it&nbsp;being&nbsp;drawn&nbsp;(tearing).&nbsp;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;has&nbsp;a&nbsp;lot&nbsp;of&nbsp;consequences&nbsp;for&nbsp;&quot;pro&quot;&nbsp;applications&nbsp;requiring&nbsp;active&nbsp;stereo&nbsp;or&nbsp;synchronization&nbsp;to&nbsp;external&nbsp;sources&nbsp;(CAVE,&nbsp;TV&nbsp;studios,&nbsp;etc.).&nbsp;However,&nbsp;an&nbsp;average&nbsp;desktop&nbsp;application&nbsp;(e.g.&nbsp;a&nbsp;3D&nbsp;game)&nbsp;benefits,&nbsp;because&nbsp;it&nbsp;is&nbsp;typically&nbsp;going&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;run&nbsp;faster&nbsp;and&nbsp;smoother&nbsp;when&nbsp;not&nbsp;having&nbsp;to&nbsp;block&nbsp;on&nbsp;VSYNC.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;blog&nbsp;explains&nbsp;the&nbsp;issue&nbsp;quite&nbsp;well:&nbsp;&lt;br&gt;&lt;a&nbsp;href=&quot;http://joostdevblog.blogspot.fr/2011/10/what-no-one-told-you-about-videocard.html&quot;&gt;http://joostdevblog.blogspot.fr/2011/10/what-no-one-told-you-about-videocard.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jan&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
