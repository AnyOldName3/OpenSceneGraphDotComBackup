<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Fabian&nbsp;&amp;&nbsp;Chris,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;was&nbsp;curious&nbsp;about&nbsp;the&nbsp;clean&nbsp;up&nbsp;of&nbsp;the&nbsp;global&nbsp;getGlobalReferencedMutex()&nbsp;so&nbsp;I&nbsp;added&nbsp;some&nbsp;debug&nbsp;messages&nbsp;to&nbsp;OpenThreads&nbsp;and&nbsp;to&nbsp;relevant&nbsp;calls&nbsp;in&nbsp;the&nbsp;OSG&nbsp;to&nbsp;track&nbsp;the&nbsp;creation&nbsp;and&nbsp;clean&nbsp;up&nbsp;of&nbsp;mutexes. &nbsp;I&nbsp;tried&nbsp;an&nbsp;alternative&nbsp;means&nbsp;of&nbsp;static&nbsp;initialization&nbsp;of&nbsp;the&nbsp;static&nbsp;getGlobalReferencedMutex()&nbsp;and&nbsp;got&nbsp;the&nbsp;same&nbsp;behavior&nbsp;for&nbsp;before&nbsp;and&nbsp;after&nbsp;results&nbsp;so&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;the&nbsp;version&nbsp;in&nbsp;the&nbsp;3.6&nbsp;branch&nbsp;is&nbsp;likley&nbsp;to&nbsp;be&nbsp;be&nbsp;a&nbsp;source&nbsp;of&nbsp;problem,&nbsp;even&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;particular&nbsp;clean. &nbsp;Below&nbsp;is&nbsp;diff&nbsp;of&nbsp;the&nbsp;changes&nbsp;I&nbsp;made.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Robert&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$&nbsp;git&nbsp;diff&lt;br&gt;diff&nbsp;--git&nbsp;a/src/OpenThreads/pthreads/PThreadMutex.cpp&nbsp;b/src/OpenThreads/pthreads/PThreadMutex.cpp&lt;br&gt;index&nbsp;3a3d1c338..d122fc67c&nbsp;100644&lt;br&gt;---&nbsp;a/src/OpenThreads/pthreads/PThreadMutex.cpp&lt;br&gt;+++&nbsp;b/src/OpenThreads/pthreads/PThreadMutex.cpp&lt;br&gt;@@&nbsp;-22,6&nbsp;+22,8&nbsp;@@&lt;br&gt; #include&nbsp;&lt;OpenThreads/Mutex&gt;&lt;br&gt; #include&nbsp;&quot;PThreadMutexPrivateData.h&quot;&lt;br&gt; &lt;br&gt;+#include&nbsp;&lt;stdio.h&gt;&lt;br&gt;+&lt;br&gt; using&nbsp;namespace&nbsp;OpenThreads;&lt;br&gt; &lt;br&gt; //----------------------------------------------------------------------------&lt;br&gt;@@&nbsp;-33,7&nbsp;+35,7&nbsp;@@&nbsp;using&nbsp;namespace&nbsp;OpenThreads;&lt;br&gt; Mutex::Mutex(MutexType&nbsp;type):&lt;br&gt; &nbsp; &nbsp; _mutexType(type)&lt;br&gt; {&lt;br&gt;-&lt;br&gt;+&nbsp; &nbsp; printf(&quot;Mutex::Mutex(%d)&nbsp;%p\n&quot;,&nbsp;type,&nbsp;this);&lt;br&gt; &nbsp; &nbsp; pthread_mutexattr_t&nbsp;mutex_attr;&lt;br&gt; &nbsp; &nbsp; pthread_mutexattr_init(&nbsp;&amp;mutex_attr&nbsp;);&lt;br&gt; &nbsp; &nbsp; &lt;br&gt;@@&nbsp;-107,6&nbsp;+109,8&nbsp;@@&nbsp;Mutex::Mutex(MutexType&nbsp;type):&lt;br&gt; //&lt;br&gt; Mutex::~Mutex()&nbsp;{&lt;br&gt; &lt;br&gt;+&nbsp; &nbsp; printf(&quot;Mutex::~Mutex()&nbsp;%p\n&quot;,&nbsp;this);&lt;br&gt;+&lt;br&gt; &nbsp; &nbsp; PThreadMutexPrivateData&nbsp;*pd&nbsp;=&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; static_cast&lt;PThreadMutexPrivateData*&gt;(_prvData);&lt;br&gt; &lt;br&gt;diff&nbsp;--git&nbsp;a/src/osg/Referenced.cpp&nbsp;b/src/osg/Referenced.cpp&lt;br&gt;index&nbsp;95b665c57..267bda310&nbsp;100644&lt;br&gt;---&nbsp;a/src/osg/Referenced.cpp&lt;br&gt;+++&nbsp;b/src/osg/Referenced.cpp&lt;br&gt;@@&nbsp;-79,11&nbsp;+79,16&nbsp;@@&nbsp;struct&nbsp;ResetPointer&lt;br&gt; };&lt;br&gt; &lt;br&gt; typedef&nbsp;ResetPointer&lt;DeleteHandler&gt;&nbsp;DeleteHandlerPointer;&lt;br&gt;+&lt;br&gt;+#if&nbsp;1&lt;br&gt;+#include&nbsp;&lt;stdio.h&gt;&lt;br&gt;+&lt;br&gt; typedef&nbsp;ResetPointer&lt;OpenThreads::Mutex&gt;&nbsp;GlobalMutexPointer;&lt;br&gt; &lt;br&gt; OpenThreads::Mutex*&nbsp;Referenced::getGlobalReferencedMutex()&lt;br&gt; {&lt;br&gt; &nbsp; &nbsp; static&nbsp;GlobalMutexPointer&nbsp;s_ReferencedGlobalMutext&nbsp;=&nbsp;new&nbsp;OpenThreads::Mutex;&lt;br&gt;+&nbsp; &nbsp; printf(&quot;Referenced::getGlobalReferencedMutex()&nbsp;%p\n&quot;,&nbsp;(s_ReferencedGlobalMutext.get()));&lt;br&gt; &nbsp; &nbsp; return&nbsp;s_ReferencedGlobalMutext.get();&lt;br&gt; }&lt;br&gt; &lt;br&gt;@@&nbsp;-96,6&nbsp;+101,17&nbsp;@@&nbsp;struct&nbsp;InitGlobalMutexes&lt;br&gt; &nbsp; &nbsp; }&lt;br&gt; };&lt;br&gt; static&nbsp;InitGlobalMutexes&nbsp;s_initGlobalMutexes;&lt;br&gt;+#else&lt;br&gt;+&lt;br&gt;+#include&nbsp;&lt;stdio.h&gt;&lt;br&gt;+&lt;br&gt;+static&nbsp;OpenThreads::Mutex&nbsp;s_ReferencedGlobalMutex;&lt;br&gt;+OpenThreads::Mutex*&nbsp;Referenced::getGlobalReferencedMutex()&lt;br&gt;+{&lt;br&gt;+&nbsp; &nbsp; printf(&quot;Referenced::getGlobalReferencedMutex()&nbsp;%p\n&quot;,&nbsp;(&amp;s_ReferencedGlobalMutex));&lt;br&gt;+&nbsp; &nbsp; return&nbsp;&amp;s_ReferencedGlobalMutex;&lt;br&gt;+}&lt;br&gt;+#endif&lt;br&gt; &lt;br&gt; //&nbsp;static&nbsp;std::auto_ptr&lt;DeleteHandler&gt;&nbsp;s_deleteHandler(0);&lt;br&gt; static&nbsp;DeleteHandlerPointer&nbsp;s_deleteHandler(0);&lt;br&gt;diff&nbsp;--git&nbsp;a/src/osg/StateAttribute.cpp&nbsp;b/src/osg/StateAttribute.cpp&lt;br&gt;index&nbsp;e239fb3aa..c7df40894&nbsp;100644&lt;br&gt;---&nbsp;a/src/osg/StateAttribute.cpp&lt;br&gt;+++&nbsp;b/src/osg/StateAttribute.cpp&lt;br&gt;@@&nbsp;-39,6&nbsp;+39,8&nbsp;@@&nbsp;void&nbsp;StateAttribute::removeParent(osg::StateSet*&nbsp;object)&lt;br&gt; &lt;br&gt; &nbsp; &nbsp; ParentList::iterator&nbsp;pitr&nbsp;=&nbsp;std::find(_parents.begin(),_parents.end(),object);&lt;br&gt; &nbsp; &nbsp; if&nbsp;(pitr!=_parents.end())&nbsp;_parents.erase(pitr);&lt;br&gt;+&lt;br&gt;+&nbsp; &nbsp; printf(&quot;StateAttribute::removeParent()\n&quot;);&lt;br&gt; }&lt;br&gt; &lt;br&gt; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
