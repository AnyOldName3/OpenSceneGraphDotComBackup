<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Fabian,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Link-time&nbsp;optimisation&nbsp;should&nbsp;be&nbsp;fine&nbsp;-&nbsp;we&nbsp;do&nbsp;it&nbsp;on&nbsp;release&nbsp;builds&nbsp;with&nbsp;no&nbsp;problems.&nbsp;It&#39;s&nbsp;either&nbsp;something&nbsp;you&#39;ve&nbsp;changed,&nbsp;or&nbsp;it&#39;s&nbsp;the&nbsp;static&nbsp;linking.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;exactly&nbsp;which&nbsp;version&nbsp;of&nbsp;OpenMW&nbsp;and&nbsp;OSG&nbsp;you&#39;ve&nbsp;built,&nbsp;though.&nbsp;It&#39;s&nbsp;pretty&nbsp;obviously&nbsp;not&nbsp;the&nbsp;RC&nbsp;this&nbsp;thread&nbsp;is&nbsp;discussing&nbsp;if&nbsp;you&#39;re&nbsp;using&nbsp;an&nbsp;existing&nbsp;OpenMW&nbsp;release&nbsp;or&nbsp;something&nbsp;you&nbsp;got&nbsp;from&nbsp;the&nbsp;master&nbsp;branch&nbsp;with&nbsp;no&nbsp;local&nbsp;changes,&nbsp;as&nbsp;OpenMW&nbsp;literally&nbsp;won&#39;t&nbsp;build&nbsp;without&nbsp;unofficial&nbsp;changes&nbsp;yet.&nbsp;Can&nbsp;you&nbsp;get&nbsp;back&nbsp;to&nbsp;us&nbsp;with&nbsp;a&nbsp;specific&nbsp;answer?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chris&lt;br&gt;&lt;br&gt;On&nbsp;Tuesday,&nbsp;28&nbsp;January&nbsp;2020&nbsp;23:13:47&nbsp;UTC,&nbsp;Fabian&nbsp;Roth&nbsp;&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;br&gt;On&nbsp;Tuesday,&nbsp;January&nbsp;28,&nbsp;2020&nbsp;at&nbsp;10:11:49&nbsp;AM&nbsp;UTC+1,&nbsp;OpenSceneGraph&nbsp;Users&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0;margin-left:0.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Fabian,&lt;br&gt;&lt;/div&gt; &lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;My&nbsp;build&nbsp;is&nbsp;using&nbsp;static&nbsp;osg,&nbsp;static&nbsp;osg-plugins&nbsp;and&nbsp;link&nbsp;time&nbsp;optimization.&lt;div&gt;I&nbsp;created&nbsp;an&nbsp;address&nbsp;sanitizer&nbsp;enabled&nbsp;build.&lt;/div&gt;&lt;div&gt;It&nbsp;exhibits&nbsp;a&nbsp;heap-use-after-free.&lt;br&gt;&lt;/div&gt;I&nbsp;will&nbsp;try&nbsp;to&nbsp;further&nbsp;investigate&nbsp;this&nbsp;week.&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;==============================&lt;wbr&gt;==============================&lt;wbr&gt;=====&lt;br&gt;==11872==ERROR:&nbsp;AddressSanitizer:&nbsp;heap-use-after-free&nbsp;on&nbsp;address&nbsp;0x6030000082c0&nbsp;at&nbsp;pc&nbsp;0x55b4b9659551&nbsp;bp&nbsp;0x7ffdf8a9c190&nbsp;sp&nbsp;0x7ffdf8a9c180&lt;br&gt;READ&nbsp;of&nbsp;size&nbsp;8&nbsp;at&nbsp;0x6030000082c0&nbsp;thread&nbsp;T0&lt;br&gt;   &nbsp;#0&nbsp;0x55b4b9659550&nbsp;in&nbsp;OpenThreads::&lt;wbr&gt;ScopedPointerLock&lt;OpenThreads:&lt;wbr&gt;:Mutex&gt;::ScopedPointerLock(&lt;wbr&gt;OpenThreads::Mutex*)&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/include/&lt;wbr&gt;OpenThreads/ScopedLock:54&lt;br&gt;   &nbsp;#1&nbsp;0x55b4b9659550&nbsp;in&nbsp;osg::StateAttribute::&lt;wbr&gt;removeParent(osg::StateSet*)&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osg/&lt;wbr&gt;StateAttribute.cpp:38&lt;br&gt;   &nbsp;#2&nbsp;0x55b4b965a033&nbsp;in&nbsp;osg::StateSet::clear()&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osg/&lt;wbr&gt;StateSet.cpp:734&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Given&nbsp;the&nbsp;stack&nbsp;trace&nbsp;it&nbsp;kinda&nbsp;looks&nbsp;like&nbsp;the&nbsp;getRefMutex()&nbsp;call&nbsp;in&nbsp;StateAttribute.cpp&nbsp;is&nbsp;the&nbsp;where&nbsp;things&nbsp;might&nbsp;be&nbsp;going&nbsp;astray&nbsp;(note&nbsp;the&nbsp;comment&nbsp;I&#39;ve&nbsp;added&nbsp;below):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;void&nbsp;StateAttribute::removeParent(&lt;wbr&gt;osg::StateSet*&nbsp;object)&lt;br&gt;{&lt;br&gt; &nbsp; &nbsp;OpenThreads::&lt;wbr&gt;ScopedPointerLock&lt;OpenThreads:&lt;wbr&gt;:Mutex&gt;&nbsp;lock(getRefMutex());&nbsp;//&nbsp;calls&nbsp;the&nbsp;base&nbsp;classes&nbsp;Referenced::getRefMutex()&nbsp;method&nbsp;that&nbsp;will&nbsp;map&nbsp;to&nbsp;Referenced::&lt;wbr&gt;getGlobalReferencedMutex&lt;br&gt;&lt;br&gt; &nbsp; &nbsp;ParentList::iterator&nbsp;pitr&nbsp;=&nbsp;std::find(_parents.begin(),_&lt;wbr&gt;parents.end(),object);&lt;br&gt; &nbsp; &nbsp;if&nbsp;(pitr!=_parents.end())&nbsp;_parents.erase(pitr);&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;Referenced::&lt;wbr&gt;getGlobalReferencedMutex()&nbsp;implementation&nbsp;in&nbsp;Referenced.cpp&nbsp;is:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OpenThreads::Mutex*&nbsp;Referenced::&lt;wbr&gt;getGlobalReferencedMutex()&lt;br&gt;{&lt;br&gt; &nbsp; &nbsp;static&nbsp;GlobalMutexPointer&nbsp;s_ReferencedGlobalMutext&nbsp;=&nbsp;new&nbsp;OpenThreads::Mutex;&lt;br&gt; &nbsp; &nbsp;return&nbsp;s_ReferencedGlobalMutext.get()&lt;wbr&gt;;&lt;br&gt;}&lt;br&gt;&lt;br&gt;//&nbsp;helper&nbsp;class&nbsp;for&nbsp;forcing&nbsp;the&nbsp;global&nbsp;mutex&nbsp;to&nbsp;be&nbsp;constructed&nbsp;when&nbsp;the&nbsp;library&nbsp;is&nbsp;loaded.&lt;br&gt;struct&nbsp;InitGlobalMutexes&lt;br&gt;{&lt;br&gt; &nbsp; &nbsp;InitGlobalMutexes()&lt;br&gt; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;Referenced::&lt;wbr&gt;getGlobalReferencedMutex();&lt;br&gt; &nbsp; &nbsp;}&lt;br&gt;};&lt;br&gt;static&nbsp;InitGlobalMutexes&nbsp;s_initGlobalMutexes;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Which&nbsp;is&nbsp;all&nbsp;a&nbsp;bit&nbsp;hacky&nbsp;way&nbsp;of&nbsp;trying&nbsp;to&nbsp;get&nbsp;a&nbsp;singleton&#39;s&nbsp;_ReferencedGlobalMutext&nbsp;to&nbsp;construct&nbsp;before&nbsp;any&nbsp;other&nbsp;code&nbsp;calling&nbsp;getGlobalReferencedMutex()&nbsp;gets&nbsp;called.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;really&nbsp;know&nbsp;why&nbsp;a&nbsp;pointer&nbsp;is&nbsp;even&nbsp;being&nbsp;used&nbsp;here,&nbsp;it&#39;s&nbsp;not&nbsp;how&nbsp;I&#39;d&nbsp;write&nbsp;the&nbsp;code&nbsp;these&nbsp;days,&nbsp;but&nbsp;off&nbsp;the&nbsp;top&nbsp;of&nbsp;my&nbsp;head&nbsp;don&#39;t&nbsp;recall&nbsp;the&nbsp;derivation&nbsp;and&nbsp;motivations&nbsp;between&nbsp;all&nbsp;this&nbsp;code&nbsp;as&nbsp;it&nbsp;dates&nbsp;back&nbsp;to&nbsp;the&nbsp;earliest&nbsp;days&nbsp;of&nbsp;the&nbsp;OSG&nbsp;project,&nbsp;so&nbsp;almost&nbsp;two&nbsp;decades&nbsp;:-)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&#39;d&nbsp;write&nbsp;today&nbsp;would&nbsp;simply&nbsp;be:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;static&nbsp;OpenThreads::Mutex&nbsp;s_ReferencedGlobalMutex;&lt;br&gt;OpenThreads::Mutex*&nbsp;Referenced::&lt;wbr&gt;getGlobalReferencedMutex()&lt;br&gt;{&lt;br&gt; &nbsp; &nbsp;return&nbsp;&amp;s_ReferencedGlobalMutex;&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;could&nbsp;try&nbsp;substituting&nbsp;this&nbsp;in. &nbsp;I&nbsp;will&nbsp;try&nbsp;a&nbsp;build&nbsp;here&nbsp;just&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;above&nbsp;works&nbsp;fine&nbsp;for&nbsp;standard&nbsp;OSG&nbsp;work. &nbsp;I&nbsp;don&#39;t&nbsp;expect&nbsp;this&nbsp;change&nbsp;to&nbsp;have&nbsp;any&nbsp;affect&nbsp;on&nbsp;your&nbsp;own&nbsp;code,&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;suggest&nbsp;there&nbsp;is&nbsp;some&nbsp;issue&nbsp;with&nbsp;order&nbsp;of&nbsp;clean&nbsp;up&nbsp;of&nbsp;statics.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Robert.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hi&nbsp;Robert,&lt;/div&gt;&lt;div&gt;Using&nbsp;your&nbsp;suggested&nbsp;changes&nbsp;i&nbsp;get&nbsp;a&nbsp;crash&nbsp;on&nbsp;start.&lt;/div&gt;&lt;div&gt;I&nbsp;forgot&nbsp;to&nbsp;mention&nbsp;i&nbsp;also&nbsp;link&nbsp;OpenThreads&nbsp;statically.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;starting&nbsp;to&nbsp;suspect&nbsp;the&nbsp;static&nbsp;linking&nbsp;and&nbsp;optimization&nbsp;surfaces&nbsp;undefined&nbsp;behavior.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Greetings,&lt;/div&gt;&lt;div&gt;Fabian&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ASAN:DEADLYSIGNAL&lt;br&gt;==============================&lt;wbr&gt;==============================&lt;wbr&gt;=====&lt;br&gt;==19668==ERROR:&nbsp;AddressSanitizer:&nbsp;SEGV&nbsp;on&nbsp;unknown&nbsp;address&nbsp;0x000000000010&nbsp;(pc&nbsp;0x5597ebadb5ac&nbsp;bp&nbsp;0x60c000000b80&nbsp;sp&nbsp;0x7ffce8efbba0&nbsp;T0)&lt;br&gt;==19668==The&nbsp;signal&nbsp;is&nbsp;caused&nbsp;by&nbsp;a&nbsp;READ&nbsp;memory&nbsp;access.&lt;br&gt;==19668==Hint:&nbsp;address&nbsp;points&nbsp;to&nbsp;the&nbsp;zero&nbsp;page.&lt;br&gt;   &nbsp;#0&nbsp;0x5597ebadb5ab&nbsp;in&nbsp;OpenThreads::&lt;wbr&gt;ScopedPointerLock&lt;OpenThreads:&lt;wbr&gt;:Mutex&gt;::ScopedPointerLock(&lt;wbr&gt;OpenThreads::Mutex*)&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/include/&lt;wbr&gt;OpenThreads/ScopedLock:54&lt;br&gt;   &nbsp;#1&nbsp;0x5597ebadb5ab&nbsp;in&nbsp;addParent&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osg/&lt;wbr&gt;StateAttribute.cpp:31&lt;br&gt;   &nbsp;#2&nbsp;0x5597ebadbc84&nbsp;in&nbsp;setAttribute&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osg/&lt;wbr&gt;StateSet.cpp:1784&lt;br&gt;   &nbsp;#3&nbsp;0x5597ebadc737&nbsp;in&nbsp;osg::StateSet::&lt;wbr&gt;setAttributeAndModes(osg::&lt;wbr&gt;StateAttribute*,&nbsp;unsigned&nbsp;int)&nbsp;[clone&nbsp;.part.309]&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osg/&lt;wbr&gt;StateSet.cpp:1076&lt;br&gt;   &nbsp;#4&nbsp;0x5597ebcb7241&nbsp;in&nbsp;__base_ctor &nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osgUtil/&lt;wbr&gt;RenderBin.cpp:174&lt;br&gt;   &nbsp;#5&nbsp;0x5597ebcb7a37&nbsp;in&nbsp;__base_ctor &nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osgUtil/&lt;wbr&gt;RenderBin.cpp:37&lt;br&gt;   &nbsp;#6&nbsp;0x5597ebcb7a37&nbsp;in&nbsp;renderBinPrototypeList&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osgUtil/&lt;wbr&gt;RenderBin.cpp:53&lt;br&gt;   &nbsp;#7&nbsp;0x5597eab5bacb&nbsp;in&nbsp;RenderBinSingletonProxy::&lt;wbr&gt;RenderBinSingletonProxy()&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osgUtil/&lt;wbr&gt;RenderBin.cpp:58&lt;br&gt;   &nbsp;#8&nbsp;0x5597eab5bacb&nbsp;in&nbsp;__static_initialization_and_&lt;wbr&gt;destruction_0&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osgUtil/&lt;wbr&gt;RenderBin.cpp:58&lt;br&gt;   &nbsp;#9&nbsp;0x5597eab5bacb&nbsp;in&nbsp;_GLOBAL__sub_I__&lt;wbr&gt;ZN7osgUtil9RenderBin21getRende&lt;wbr&gt;rBinPrototypeERKNSt7__&lt;wbr&gt;cxx1112basic_stringIcSt11char_&lt;wbr&gt;traitsIcESaIcEEE.lto_priv.3181&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/src/osgUtil/&lt;wbr&gt;RenderBin.cpp:665&lt;br&gt;   &nbsp;#10&nbsp;0x5597eabb1163&nbsp;in&nbsp;global&nbsp;constructors&nbsp;keyed&nbsp;to&nbsp;65535_0_objects.cpp.o.6481610&nbsp;(./openmw-build/openmw+&lt;wbr&gt;0x3b5163)&lt;br&gt;   &nbsp;#11&nbsp;0x5597ec775bcc&nbsp;in&nbsp;__libc_csu_init&nbsp;(./openmw-build/openmw+&lt;wbr&gt;0x1f79bcc)&lt;br&gt;   &nbsp;#12&nbsp;0x7f213df67b27&nbsp;in&nbsp;__libc_start_main&nbsp;(/lib/x86_64-linux-gnu/libc.&lt;wbr&gt;so.6+0x21b27)&lt;br&gt;   &nbsp;#13&nbsp;0x5597eabe6039&nbsp;in&nbsp;_start&nbsp;(./openmw-build/openmw+&lt;wbr&gt;0x3ea039)&lt;br&gt;&lt;br&gt;AddressSanitizer&nbsp;can&nbsp;not&nbsp;provide&nbsp;additional&nbsp;info.&lt;br&gt;SUMMARY:&nbsp;AddressSanitizer:&nbsp;SEGV&nbsp;./openmw/extern-git/&lt;wbr&gt;OpenSceneGraph/include/&lt;wbr&gt;OpenThreads/ScopedLock:54&nbsp;in&nbsp;OpenThreads::&lt;wbr&gt;ScopedPointerLock&lt;OpenThreads:&lt;wbr&gt;:Mutex&gt;::ScopedPointerLock(&lt;wbr&gt;OpenThreads::Mutex*)&lt;br&gt;==19668==ABORTING&lt;br&gt;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>
<br>
&lt;p&gt;&lt;/p&gt;<br>
<br>
--&nbsp;&lt;br&nbsp;/&gt;<br>
You&nbsp;received&nbsp;this&nbsp;message&nbsp;because&nbsp;you&nbsp;are&nbsp;subscribed&nbsp;to&nbsp;the&nbsp;Google&nbsp;Groups&nbsp;&quot;OpenSceneGraph&nbsp;Users&quot;&nbsp;group.&lt;br&nbsp;/&gt;<br>
To&nbsp;unsubscribe&nbsp;from&nbsp;this&nbsp;group&nbsp;and&nbsp;stop&nbsp;receiving&nbsp;emails&nbsp;from&nbsp;it,&nbsp;send&nbsp;an&nbsp;email&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;mailto:osg-users+unsubscribe@googlegroups.com&quot;&gt;osg-users+unsubscribe@googlegroups.com&lt;/a&gt;.&lt;br&nbsp;/&gt;<br>
To&nbsp;view&nbsp;this&nbsp;discussion&nbsp;on&nbsp;the&nbsp;web&nbsp;visit&nbsp;&lt;a&nbsp;href=&quot;https://groups.google.com/d/msgid/osg-users/14ff71fc-b430-4ff5-a2a5-1bd3d2fc163e%40googlegroups.com?utm_medium=email&amp;utm_source=footer&quot;&gt;https://groups.google.com/d/msgid/osg-users/14ff71fc-b430-4ff5-a2a5-1bd3d2fc163e%40googlegroups.com&lt;/a&gt;.&lt;br&nbsp;/&gt;<br>

</tt>
