<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Robert,&lt;div&gt;I&nbsp;was&nbsp;trying&nbsp;to&nbsp;use&nbsp;the&nbsp;pragmatic&nbsp;shader&nbsp;comp&nbsp;in&nbsp;OSG&nbsp;3.4&nbsp;and&nbsp;ran&nbsp;into&nbsp;the&nbsp;following&nbsp;bug.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;osg::Shader&nbsp;attempts&nbsp;to&nbsp;extract&nbsp;the&nbsp;&quot;#version&quot;&nbsp;string&nbsp;and&nbsp;insert&nbsp;the&nbsp;new&nbsp;#define&nbsp;statements&nbsp;between&nbsp;the&nbsp;#version&nbsp;line&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;source.&nbsp;However,&nbsp;if&nbsp;the&nbsp;#version&nbsp;line&nbsp;ends&nbsp;in&nbsp;a&nbsp;CRLF&nbsp;combination&nbsp;(\r\n),&nbsp;the&nbsp;LF&nbsp;is&nbsp;stripped&nbsp;and&nbsp;never&nbsp;replaced&nbsp;--&nbsp;this&nbsp;causes&nbsp;the&nbsp;NVIDIA&nbsp;driver&nbsp;to&nbsp;report&nbsp;an&nbsp;illegal&nbsp;version&nbsp;string.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;was&nbsp;able&nbsp;to&nbsp;fix&nbsp;it&nbsp;by&nbsp;checking&nbsp;for&nbsp;a&nbsp;LF&nbsp;and&nbsp;appending&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;missing.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;Shader::PerContextShader::compileShader,&nbsp;I&nbsp;inserted&nbsp;this&nbsp;line:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;if&nbsp;((end_of_line-start_of_line)&gt;=8&nbsp;&amp;&amp;&nbsp;source.compare(start_of_line,&nbsp;8,&nbsp;&quot;#version&quot;)==0)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;versionLine&nbsp;=&nbsp;source.substr(start_of_line,&nbsp;end_of_line-start_of_line+1);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;if&nbsp;(versionLine.back()&nbsp;!=&nbsp;&#39;\n&#39;)&nbsp;versionLine.push_back(&#39;\n&#39;);&nbsp; &nbsp; //&nbsp;FIX&nbsp;BY&nbsp;INSERTING&nbsp;THIS&nbsp;LINE&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;if&nbsp;(source[source.size()-1]!=&#39;\n&#39;)&nbsp;source.push_back(&#39;\n&#39;);&lt;/div&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;think&nbsp;this&nbsp;fix&nbsp;makes&nbsp;sense&nbsp;to&nbsp;put&nbsp;in&nbsp;the&nbsp;master.&nbsp;Thanks.&lt;/div&gt;&lt;div&gt; &lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Glenn&nbsp;Waldron&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
