<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;For&nbsp;context,&nbsp;I&nbsp;come&nbsp;from&nbsp;an&nbsp;image&nbsp;processing&nbsp;and&nbsp;signal&nbsp;processing&nbsp;background,&nbsp;so&nbsp;computer&nbsp;graphics&nbsp;and&nbsp;OSG&nbsp;are&nbsp;both&nbsp;new&nbsp;to&nbsp;me.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;I&#39;m&nbsp;trying&nbsp;to&nbsp;use&nbsp;osgVolume&nbsp;for&nbsp;volume&nbsp;rendering&nbsp;some&nbsp;data.&nbsp;The&nbsp;only&nbsp;real&nbsp;example&nbsp;code&nbsp;I&nbsp;can&nbsp;find&nbsp;out&nbsp;there&nbsp;is&nbsp;the&nbsp;osgvolume&nbsp;example&nbsp;that&nbsp;ships&nbsp;with&nbsp;OSG.&nbsp;I&#39;m&nbsp;a&nbsp;bit&nbsp;confused&nbsp;about&nbsp;the&nbsp;usage&nbsp;model&nbsp;with&nbsp;the&nbsp;various&nbsp;VolumeTechnique&nbsp;classes.&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;I&#39;m&nbsp;working&nbsp;with&nbsp;GL_RGBA&nbsp;uint8&nbsp;data.&nbsp;In&nbsp;my&nbsp;code,&nbsp;I&nbsp;define&nbsp;a&nbsp;function&nbsp;createTexture3D&nbsp;that&nbsp;creates&nbsp;an&nbsp;osg::Image&nbsp;object.&nbsp;The&nbsp;image&nbsp;is&nbsp;defined&nbsp;as:&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/p&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;div&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osg::Image&gt;&nbsp;image_3d&nbsp;=&nbsp;new&nbsp;osg::Image;&lt;/strong&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp;image_3d-&gt;allocateImage(nmSAFE_CAST(int,&nbsp;s_nearestPowerOfTwo),&lt;/strong&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nmSAFE_CAST(int,&nbsp;t_nearestPowerOfTwo),&lt;/strong&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nmSAFE_CAST(int,&nbsp;r_nearestPowerOfTwo),&lt;/strong&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;desiredPixelFormat,&nbsp;GL_UNSIGNED_BYTE);​&lt;/strong&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;When&nbsp;I&nbsp;started&nbsp;with&nbsp;a&nbsp;simple&nbsp;example,&nbsp;FixedFunctionTechnique&nbsp;rendered&nbsp;my&nbsp;data&nbsp;as&nbsp;I&nbsp;expected.&nbsp;See&nbsp;fixedFunctionTechnique.png attached.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt;osg::ref_ptr&lt;osgVolume::VolumeTile&gt;&nbsp;tile&nbsp;=&nbsp;new&nbsp;osgVolume::VolumeTile;&lt;/strong&gt;&lt;br&gt;&lt;/p&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;volume-&gt;addChild(tile.get());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osg::Image&gt;&nbsp;image_3d&nbsp;=&nbsp;createTexture3D(data,xfer_table);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osgVolume::ImageLayer&gt;&nbsp;layer&nbsp;=&nbsp;new&nbsp;osgVolume::ImageLayer(image_3d.get());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tile-&gt;setLayer(layer.get());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tile-&gt;setVolumeTechnique(new&nbsp;osgVolume::FixedFunctionTechnique());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;FixedFunctionTechnique&nbsp;turns&nbsp;on&nbsp;GL_LIGHTING,&nbsp;which&nbsp;breaks&nbsp;the&nbsp;color&nbsp;rendering.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::StateSet*&nbsp;stateset&nbsp;=&nbsp;volume-&gt;getOrCreateStateSet();&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stateset-&gt;setMode(GL_LIGHTING,osg::StateAttribute::OFF&nbsp;|&nbsp;osg::StateAttribute::OVERRIDE);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;Our&nbsp;original&nbsp;implementation&nbsp;positioned&nbsp;the&nbsp;bbox&nbsp;[-0.5,0.5]&nbsp;in&nbsp;each&nbsp;dimension.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;FixedFunctionTechnique&nbsp;applies&nbsp;the&nbsp;locator&nbsp;matrix&nbsp;to&nbsp;the&nbsp;a&nbsp;unit&nbsp;cube&nbsp;[0&nbsp;1]&nbsp;in&nbsp;each&nbsp;dimension.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;To&nbsp;get&nbsp;the&nbsp;equivalent&nbsp;spatial&nbsp;referencing,&nbsp;apply&nbsp;a&nbsp;translation&nbsp;of&nbsp;-0.5&nbsp;to&nbsp;each&nbsp;dimension.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osg::RefMatrix&gt;&nbsp;matrix&nbsp;=&nbsp;new&nbsp;osg::RefMatrix();&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;matrix-&gt;makeTranslate(-0.5,-0.5,-0.5);&lt;/strong&gt;&lt;br&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;I&nbsp;attempted&nbsp;to&nbsp;modify&nbsp;this&nbsp;simple&nbsp;example&nbsp;to&nbsp;use&nbsp;RayTracedTechnique&nbsp;next.&nbsp;When&nbsp;I&nbsp;do&nbsp;that,&nbsp;both&nbsp;the&nbsp;color&nbsp;and&nbsp;the&nbsp;opacity&nbsp;of&nbsp;my&nbsp;volume&nbsp;data&nbsp;is&nbsp;off.&nbsp;In&nbsp;some&nbsp;cases,&nbsp;I&nbsp;see&nbsp;something&nbsp;on&nbsp;the&nbsp;screen&nbsp;(see&nbsp;attached&nbsp;screenshot,&nbsp;in&nbsp;other&nbsp;cases,&nbsp;I&nbsp;don&#39;t&nbsp;see&nbsp;anything).&nbsp;I&nbsp;almost&nbsp;feel&nbsp;like&nbsp;somehow&nbsp;my&nbsp;data&nbsp;is&nbsp;outside&nbsp;of&nbsp;an&nbsp;expected&nbsp;colormap/alphamap&nbsp;range,&nbsp;but&nbsp;I&nbsp;can&#39;t&nbsp;figure&nbsp;out&nbsp;what&#39;s&nbsp;off.&nbsp;In&nbsp;this&nbsp;particular&nbsp;example&nbsp;with&nbsp;an&nbsp;engine&nbsp;block&nbsp;CT&nbsp;dataset&nbsp;and&nbsp;a&nbsp;specific&nbsp;colormap/alphamap,&nbsp;I&nbsp;see&nbsp;what&nbsp;is&nbsp;shown&nbsp;in&nbsp;the&nbsp;attached&nbsp;rayTracedTechnique.png.&nbsp;Here&nbsp;is&nbsp;a&nbsp;partial&nbsp;code&nbsp;listing&nbsp;based&nbsp;on&nbsp;the&nbsp;OSG&nbsp;example:&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; osg::ref_ptr&lt;osg::Image&gt;&nbsp;image_3d&nbsp;=&nbsp;createTexture3D(data,xfer_table);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osgVolume::ImageLayer&gt;&nbsp;layer&nbsp;=&nbsp;new&nbsp;osgVolume::ImageLayer(image_3d.get());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tile-&gt;setLayer(layer.get());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::SwitchProperty*&nbsp;sp&nbsp;=&nbsp;new&nbsp;osgVolume::SwitchProperty;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sp-&gt;setActiveProperty(0);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::TransferFunction1D::ColorMap&nbsp;colorMap;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for&nbsp;(size_t&nbsp;r&nbsp;=&nbsp;0;&nbsp;r&nbsp;&lt;&nbsp;256;&nbsp;++r){&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;size_t&nbsp;rowOffset&nbsp;=&nbsp;r*4;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;float&nbsp;red&nbsp;=&nbsp;static_cast&lt;float&gt;(xfer_table[rowOffset])/255.0;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;float&nbsp;green&nbsp;=&nbsp;static_cast&lt;float&gt;(xfer_table[rowOffset+1])/255.0;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;float&nbsp;blue&nbsp;=&nbsp;static_cast&lt;float&gt;(xfer_table[rowOffset+2])/255.0;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;float&nbsp;alpha&nbsp;=&nbsp;static_cast&lt;float&gt;(xfer_table[rowOffset+3])/255.0;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;colorMap[r]&nbsp;=&nbsp;osg::Vec4(red,green,blue,alpha);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osg::TransferFunction1D&gt;&nbsp;transferFunction&nbsp;=&nbsp;new&nbsp;osg::TransferFunction1D;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transferFunction-&gt;assign(colorMap);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;float&nbsp;alphaFunc=0.02f;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;float&nbsp;sampleDensityWhenMoving&nbsp;=&nbsp;0.02;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::AlphaFuncProperty*&nbsp;ap&nbsp;=&nbsp;new&nbsp;osgVolume::AlphaFuncProperty(alphaFunc);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::SampleDensityProperty*&nbsp;sd&nbsp;=&nbsp;new&nbsp;osgVolume::SampleDensityProperty(0.005);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::SampleDensityWhenMovingProperty*&nbsp;sdwm&nbsp;=&nbsp;sampleDensityWhenMoving!=0.0&nbsp;?&nbsp;new&nbsp;osgVolume::SampleDensityWhenMovingProperty(sampleDensityWhenMoving)&nbsp;:&nbsp;0;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::TransparencyProperty*&nbsp;tp&nbsp;=&nbsp;new&nbsp;osgVolume::TransparencyProperty(1.0);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::TransferFunctionProperty*&nbsp;tfp&nbsp;=&nbsp;transferFunction.valid()&nbsp;?&nbsp;new&nbsp;osgVolume::TransferFunctionProperty(transferFunction.get())&nbsp;:&nbsp;0;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;Standard&nbsp;config&nbsp;from&nbsp;osgVolume&nbsp;example&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osgVolume::CompositeProperty*&nbsp;cp&nbsp;=&nbsp;new&nbsp;osgVolume::CompositeProperty;&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cp-&gt;addProperty(ap);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cp-&gt;addProperty(sd);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cp-&gt;addProperty(tp);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(sdwm)&nbsp;cp-&gt;addProperty(sdwm);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;if&nbsp;(tfp)&nbsp;cp-&gt;addProperty(tfp);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sp-&gt;addProperty(cp);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sp-&gt;setActiveProperty(0);&nbsp;//&nbsp;For&nbsp;now,&nbsp;always&nbsp;use&nbsp;&quot;Standard&quot;&nbsp;config&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;layer-&gt;addProperty(sp);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tile-&gt;setVolumeTechnique(new&nbsp;osgVolume::RayTracedTechnique());&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;FixedFunctionTechnique&nbsp;turns&nbsp;on&nbsp;GL_LIGHTING,&nbsp;which&nbsp;breaks&nbsp;the&nbsp;color&nbsp;rendering.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::StateSet*&nbsp;stateset&nbsp;=&nbsp;volume-&gt;getOrCreateStateSet();&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;stateset-&gt;setMode(GL_LIGHTING,osg::StateAttribute::OFF&nbsp;|&nbsp;osg::StateAttribute::OVERRIDE);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;Our&nbsp;original&nbsp;implementation&nbsp;positioned&nbsp;the&nbsp;bbox&nbsp;[-0.5,0.5]&nbsp;in&nbsp;each&nbsp;dimension.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;FixedFunctionTechnique&nbsp;applies&nbsp;the&nbsp;locator&nbsp;matrix&nbsp;to&nbsp;the&nbsp;a&nbsp;unit&nbsp;cube&nbsp;[0&nbsp;1]&nbsp;in&nbsp;each&nbsp;dimension.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;To&nbsp;get&nbsp;the&nbsp;equivalent&nbsp;spatial&nbsp;referencing,&nbsp;apply&nbsp;a&nbsp;translation&nbsp;of&nbsp;-0.5&nbsp;to&nbsp;each&nbsp;dimension.&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;osg::ref_ptr&lt;osg::RefMatrix&gt;&nbsp;matrix&nbsp;=&nbsp;new&nbsp;osg::RefMatrix();&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;matrix-&gt;makeTranslate(-0.5,-0.5,-0.5);&lt;/strong&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;strong&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tile-&gt;setLocator(new&nbsp;osgVolume::Locator(*matrix));&lt;/strong&gt;&lt;br&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;I&#39;ve&nbsp;spent&nbsp;the&nbsp;last&nbsp;few&nbsp;hours&nbsp;toggling&nbsp;settings&nbsp;on/off.&nbsp;I&nbsp;thought&nbsp;I&#39;d&nbsp;see&nbsp;if&nbsp;anyone&nbsp;here&nbsp;has&nbsp;ideas,&nbsp;or&nbsp;how&nbsp;I&nbsp;would&nbsp;go&nbsp;about&nbsp;debugging&nbsp;why&nbsp;things&nbsp;aren&#39;t&nbsp;rendering&nbsp;correctly.&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;I&nbsp;also&nbsp;have&nbsp;a&nbsp;specific&nbsp;question.&nbsp;When&nbsp;working&nbsp;with&nbsp;RGBA&nbsp;data,&nbsp;should&nbsp;I&nbsp;be&nbsp;specifying&nbsp;a &lt;strong&gt;osgVolume::TransferFunctionProperty&lt;/strong&gt;​,&nbsp;and&nbsp;should&nbsp;this&nbsp;property&nbsp;be&nbsp;in&nbsp;the&nbsp;float&nbsp;[0,1]&nbsp;normalized&nbsp;range&nbsp;as&nbsp;shown&nbsp;in&nbsp;the&nbsp;OSG&nbsp;example,&nbsp;or&nbsp;should&nbsp;it&nbsp;be&nbsp;in&nbsp;a&nbsp;range&nbsp;that&nbsp;matches&nbsp;my&nbsp;data?&nbsp;I&#39;m&nbsp;a&nbsp;bit&nbsp;confused&nbsp;about&nbsp;whether/why I&nbsp;need&nbsp;to&nbsp;specify&nbsp;the&nbsp;transfer&nbsp;function&nbsp;when&nbsp;my&nbsp;RGBA&nbsp;texture&nbsp;already&nbsp;knows&nbsp;the&nbsp;color&nbsp;and&nbsp;opacity&nbsp;for&nbsp;each&nbsp;voxel&nbsp;sample.&nbsp; &lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;Sorry&nbsp;for&nbsp;the&nbsp;very&nbsp;long&nbsp;email.&nbsp;I&#39;d&nbsp;appreciate&nbsp;any&nbsp;help&nbsp;or&nbsp;pointers&nbsp;anyone&nbsp;can&nbsp;provide.&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;Best,&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;Alex&nbsp;Taylor&lt;br&gt;&lt;/p&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px;line-height:24px&quot;&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
