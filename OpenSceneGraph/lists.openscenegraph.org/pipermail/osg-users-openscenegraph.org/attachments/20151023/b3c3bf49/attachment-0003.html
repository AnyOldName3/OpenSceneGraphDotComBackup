<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Cool&nbsp;stuff. &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Have&nbsp;you&nbsp;considered&nbsp;a&nbsp;non-FFP&nbsp;solution?&nbsp;Withthis,&nbsp;you&nbsp;could&nbsp;have&nbsp;more&nbsp;than&nbsp;8&nbsp;lights.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;there&nbsp;are&nbsp;alternative&nbsp;shader-based&nbsp;non-FFP&nbsp;rendering&nbsp;methods&nbsp;like&nbsp;Forward+&nbsp;that&nbsp;have&nbsp;already&nbsp;successfully&nbsp;been&nbsp;implemented&nbsp;in&nbsp;OSG-based&nbsp;tools&nbsp;that&nbsp;offer&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;lights&nbsp;with&nbsp;good&nbsp;performance:&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://www.youtube.com/watch?v=LHzNpAb_GjI&amp;app=desktop&quot;&gt;https://www.youtube.com/watch?v=LHzNpAb_GjI&amp;app=desktop&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Oct&nbsp;23,&nbsp;2015&nbsp;at&nbsp;9:58&nbsp;AM,&nbsp;Jannik&nbsp;Heller&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:scrawl@baseoftrash.de&quot;&nbsp;target=&quot;_blank&quot;&gt;scrawl@baseoftrash.de&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;OSG&nbsp;friends,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;will&nbsp;be&nbsp;wrapping&nbsp;up&nbsp;my&nbsp;OpenMW&nbsp;port&nbsp;to&nbsp;OpenSceneGraph&nbsp;soon&nbsp;and&nbsp;wanted&nbsp;to&nbsp;share&nbsp;a&nbsp;few&nbsp;things&nbsp;with&nbsp;you&nbsp;that&nbsp;I&nbsp;learned&nbsp;along&nbsp;the&nbsp;way.&nbsp;One&nbsp;such&nbsp;thing&nbsp;is&nbsp;the&nbsp;lighting&nbsp;system&nbsp;that&nbsp;I&nbsp;wrote.&nbsp;If&nbsp;you&nbsp;do&nbsp;a&nbsp;quick&nbsp;search&nbsp;on&nbsp;the&nbsp;mailing&nbsp;list,&nbsp;you&nbsp;will&nbsp;see&nbsp;that&nbsp;the&nbsp;OpenGL&nbsp;fixed&nbsp;pipeline&nbsp;supports&nbsp;a&nbsp;maximum&nbsp;of&nbsp;8&nbsp;simultaneous&nbsp;lights&nbsp;and&nbsp;OSG&nbsp;inherits&nbsp;this&nbsp;limit.&nbsp;I&nbsp;have&nbsp;a&nbsp;lot&nbsp;more&nbsp;lights&nbsp;in&nbsp;my&nbsp;scenes,&nbsp;so&nbsp;I&nbsp;had&nbsp;to&nbsp;come&nbsp;up&nbsp;with&nbsp;a&nbsp;solution.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;I&nbsp;ended&nbsp;up&nbsp;with&nbsp;is&nbsp;a&nbsp;new&nbsp;lighting&nbsp;system,&nbsp;that&nbsp;allows&nbsp;you&nbsp;to&nbsp;place&nbsp;any&nbsp;number&nbsp;of&nbsp;light&nbsp;sources&nbsp;in&nbsp;the&nbsp;scene&nbsp;graph,&nbsp;but&nbsp;then&nbsp;prior&nbsp;to&nbsp;rendering&nbsp;a&nbsp;particular&nbsp;model&nbsp;will&nbsp;set&nbsp;the&nbsp;8&nbsp;closest&nbsp;lights&nbsp;as&nbsp;the&nbsp;OpenGL&nbsp;lights.&nbsp;This&nbsp;is&nbsp;implemented&nbsp;as&nbsp;CullCallback&nbsp;for&nbsp;the&nbsp;individual&nbsp;models,&nbsp;pushing&nbsp;a&nbsp;StateSet&nbsp;with&nbsp;the&nbsp;correct&nbsp;lights&nbsp;onto&nbsp;the&nbsp;CullVisitor.&nbsp;I&nbsp;also&nbsp;needed&nbsp;to&nbsp;implement&nbsp;a&nbsp;custom&nbsp;StateAttribute&nbsp;for&nbsp;the&nbsp;light&nbsp;state,&nbsp;this&nbsp;is&nbsp;because&nbsp;when&nbsp;applying&nbsp;lights&nbsp;OpenGL&nbsp;multiplies&nbsp;the&nbsp;position&nbsp;specified&nbsp;with&nbsp;the&nbsp;current&nbsp;modelView&nbsp;matrix&nbsp;(which&nbsp;is&nbsp;no&nbsp;problem&nbsp;when&nbsp;you&nbsp;apply&nbsp;lights&nbsp;at&nbsp;beginning&nbsp;of&nbsp;frame&nbsp;like&nbsp;OSG&nbsp;does,&nbsp;but&nbsp;in&nbsp;my&nbsp;case&nbsp;the&nbsp;lights&nbsp;are&nbsp;applied&nbsp;in&nbsp;between&nbsp;renderning&nbsp;of&nbsp;models,Ii&nbsp;need&nbsp;to&nbsp;apply&nbsp;the&nbsp;lights&nbsp;in&nbsp;world&nbsp;space&nbsp;rather&nbsp;than&nbsp;relative&nbsp;to&nbsp;that&nbsp;model).&nbsp;The&nbsp;solution&nbsp;was&nbsp;to&nbsp;write&nbsp;a&nbsp;custom&nbsp;light&nbsp;StateAttribute&nbsp;that&nbsp;resets&nbsp;the&nbsp;modelView&nbsp;matrix&nbsp;to&nbsp;just&nbsp;the&nbsp;view&nbsp;matrix&nbsp;before&nbsp;applying&nbsp;the&nbsp;state,&nbsp;then&nbsp;reset&nbsp;again&nbsp;to&nbsp;modelView&nbsp;when&nbsp;done.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;code&nbsp;is&nbsp;here&nbsp;and&nbsp;it&nbsp;should&nbsp;be&nbsp;easily&nbsp;adaptable&nbsp;to&nbsp;your&nbsp;own&nbsp;applications:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/OpenMW/openmw/blob/master/components/sceneutil/lightmanager.cpp&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/OpenMW/openmw/blob/master/components/sceneutil/lightmanager.cpp&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/OpenMW/openmw/blob/master/components/sceneutil/lightmanager.hpp&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/OpenMW/openmw/blob/master/components/sceneutil/lightmanager.hpp&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Usage&nbsp;is&nbsp;pretty&nbsp;straight&nbsp;forward:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;Decorate&nbsp;your&nbsp;scene&nbsp;graph&nbsp;with&nbsp;a&nbsp;LightManager&nbsp;node.&lt;br&gt;<br>
-&nbsp;Create&nbsp;any&nbsp;number&nbsp;of&nbsp;LightSource&#39;s&nbsp;in&nbsp;the&nbsp;scene&nbsp;graph.&nbsp;The&nbsp;lightNum&nbsp;of&nbsp;the&nbsp;contained&nbsp;lights&nbsp;do&nbsp;not&nbsp;matter&nbsp;as&nbsp;they&nbsp;are&nbsp;not&nbsp;used.&lt;br&gt;<br>
-&nbsp;Make&nbsp;sure&nbsp;that&nbsp;you&nbsp;have&nbsp;Mask_Lit&nbsp;(1&lt;&lt;16)&nbsp;in&nbsp;your&nbsp;update&nbsp;and&nbsp;cull&nbsp;masks&nbsp;where&nbsp;lighting&nbsp;is&nbsp;desired.&lt;br&gt;<br>
-&nbsp;Add&nbsp;some&nbsp;LightListCallback&#39;s&nbsp;as&nbsp;CullCallback&nbsp;in&nbsp;your&nbsp;scene&nbsp;graph.&nbsp;Where&nbsp;you&nbsp;put&nbsp;the&nbsp;callbacks&nbsp;determines&nbsp;the&nbsp;granularity&nbsp;of&nbsp;the&nbsp;light&nbsp;lists,&nbsp;so&nbsp;can&nbsp;have&nbsp;an&nbsp;impact&nbsp;on&nbsp;visuals&nbsp;and&nbsp;performance.&nbsp;I&nbsp;recommend&nbsp;adding&nbsp;the&nbsp;callback&nbsp;onto&nbsp;individual&nbsp;model(s)&nbsp;(but&nbsp;not&nbsp;necessarily&nbsp;individual&nbsp;Drawable&#39;s&nbsp;as&nbsp;that&nbsp;would&nbsp;be&nbsp;slower).&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;also&nbsp;combine&nbsp;the&nbsp;LightManager&nbsp;with&nbsp;regular&nbsp;OSG&nbsp;lighting.&nbsp;For&nbsp;example,&nbsp;if&nbsp;you&nbsp;need&nbsp;a&nbsp;&quot;global&quot;&nbsp;directional&nbsp;light&nbsp;in&nbsp;your&nbsp;scene&nbsp;that&nbsp;is&nbsp;always&nbsp;active,&nbsp;you&nbsp;can&nbsp;create&nbsp;it&nbsp;as&nbsp;a&nbsp;regular&nbsp;osg::LightSource&nbsp;and&nbsp;tell&nbsp;the&nbsp;LightManager&nbsp;to&nbsp;skip&nbsp;over&nbsp;it,&nbsp;using&nbsp;setStartLight(1).&nbsp;This&nbsp;would&nbsp;mean&nbsp;the&nbsp;LightManager&nbsp;is&nbsp;only&nbsp;managing&nbsp;lights&nbsp;1-7&nbsp;rather&nbsp;than&nbsp;all&nbsp;8.&lt;br&gt;<br>
&lt;br&gt;<br>
Hope&nbsp;this&nbsp;might&nbsp;be&nbsp;useful&nbsp;to&nbsp;some&nbsp;OSG&nbsp;users&nbsp;as&nbsp;it&nbsp;took&nbsp;me&nbsp;a&nbsp;while&nbsp;to&nbsp;put&nbsp;together.&nbsp;I&nbsp;did&nbsp;find&nbsp;a&nbsp;previous&nbsp;topic&nbsp;about&nbsp;the&nbsp;subject&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;http://forum.openscenegraph.org/viewtopic.php?t=8325&amp;view=previous&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forum.openscenegraph.org/viewtopic.php?t=8325&amp;view=previous&lt;/a&gt;&nbsp;)&nbsp;but&nbsp;no&nbsp;satisfying&nbsp;solution&nbsp;was&nbsp;posted.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;wonder&nbsp;if&nbsp;there&nbsp;is&nbsp;enough&nbsp;interest,&nbsp;could&nbsp;this&nbsp;turn&nbsp;into&nbsp;an&nbsp;official&nbsp;OSG&nbsp;example?&nbsp;Or&nbsp;even&nbsp;a&nbsp;new&nbsp;NodeKit&nbsp;or&nbsp;part&nbsp;of&nbsp;the&nbsp;core&nbsp;scene&nbsp;graph?&lt;br&gt;<br>
&lt;br&gt;<br>
By&nbsp;the&nbsp;way,&nbsp;I&nbsp;am&nbsp;super&nbsp;impressed&nbsp;that&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;implement&nbsp;this&nbsp;feature&nbsp;without&nbsp;changing&nbsp;one&nbsp;line&nbsp;of&nbsp;code&nbsp;within&nbsp;OSG&nbsp;-&nbsp;the&nbsp;flexibility&nbsp;you&nbsp;get&nbsp;with&nbsp;the&nbsp;various&nbsp;visitors&nbsp;and&nbsp;callbacks&nbsp;is&nbsp;amazing.&nbsp;A&nbsp;big&nbsp;kudos&nbsp;goes&nbsp;to&nbsp;Robert&nbsp;for&nbsp;making&nbsp;the&nbsp;OSG&nbsp;so&nbsp;extensible!&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Jannik&lt;br&gt;<br>
&lt;br&gt;<br>
------------------&lt;br&gt;<br>
Read&nbsp;this&nbsp;topic&nbsp;online&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://forum.openscenegraph.org/viewtopic.php?p=65420#65420&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forum.openscenegraph.org/viewtopic.php?p=65420#65420&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
osg-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:osg-users@lists.openscenegraph.org&quot;&gt;osg-users@lists.openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.openscenegraph.org/listinfo.cgi/osg-users-openscenegraph.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style=&quot;text-align:center&quot;&gt;Chris&nbsp;&#39;Xenon&#39;&nbsp;Hanson,&nbsp;omo&nbsp;sanza&nbsp;lettere.&nbsp;Xenon@AlphaPixel.com&nbsp;&lt;a&nbsp;href=&quot;http://www.alphapixel.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.alphapixel.com/&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:center&quot;&gt;Training&nbsp;•&nbsp;Consulting&nbsp;•&nbsp;Contracting&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:center&quot;&gt;3D&nbsp;•&nbsp;Scene&nbsp;Graphs&nbsp;(Open&nbsp;Scene&nbsp;Graph/OSG)&nbsp;•&nbsp;OpenGL&nbsp;2&nbsp;•&nbsp;OpenGL&nbsp;3&nbsp;•&nbsp;OpenGL&nbsp;4&nbsp;•&nbsp;GLSL&nbsp;•&nbsp;OpenGL&nbsp;ES&nbsp;1&nbsp;•&nbsp;OpenGL&nbsp;ES&nbsp;2&nbsp;•&nbsp;OpenCL&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:center&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Legal/IP&nbsp;•&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Code&nbsp;Forensics&nbsp;•&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt; &lt;/span&gt;Digital&nbsp;Imaging&nbsp;•&nbsp;GIS&nbsp;•&nbsp;GPS&nbsp;•&nbsp;osgEarth • Terrain • Telemetry&nbsp;•&nbsp;Cryptography&nbsp;•&nbsp;LIDAR&nbsp;•&nbsp;Embedded&nbsp;•&nbsp;Mobile&nbsp;•&nbsp;iPhone/iPad/iOS&nbsp;•&nbsp;Android&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:center&quot;&gt;&lt;a&nbsp;href=&quot;https://twitter.com/alphapixel&quot;&nbsp;target=&quot;_blank&quot;&gt;@alphapixel&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://facebook.com/alphapixel&quot;&nbsp;target=&quot;_blank&quot;&gt;facebook.com/alphapixel&lt;/a&gt; (775)&nbsp;623-PIXL&nbsp;[7495]&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
