

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Upgrading from osgEarth 2.x to osgEarth 3.x &mdash; osgEarth 3.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="../../../assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Getting Support" href="support.html" />
    <link rel="prev" title="Release Notes" href="releasenotes.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="../latest/3.0_upgrade_guide.html" />

<link rel="stylesheet" href="../../../assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2020-12-02T21:12:06Z", "builder": "sphinx", "canonical_url": "http://docs.osgearth.org/en/latest/", "commit": "2b0ab5ae", "docroot": "/docs/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "3.0_upgrade_guide", "programming_language": "cpp", "project": "osgearth", "proxied_api_host": "/_", "source_suffix": ".md", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "G-H28EPNP1WC", "version": "3.1"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index-2.html" class="icon icon-home"> osgEarth
          

          
          </a>

          
            
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="http://docs.osgearth.org/en/3.1/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="earthfile.html">The Earth File</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="layers.html">Layer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgrade Guide: from 2.x to 3.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#earth-file-changes">Earth File Changes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#composite-layers">Composite layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feature-sources">Feature sources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api-changes">API Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Getting Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index-2.html">osgEarth</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index-2.html">Docs</a> &raquo;</li>
        
      <li>Upgrading from osgEarth 2.x to osgEarth 3.x</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/gwaldron/osgearth/blob/3.1/docs/source/3.0_upgrade_guide.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upgrading-from-osgearth-2-x-to-osgearth-3-x">
<h1>Upgrading from osgEarth 2.x to osgEarth 3.x<a class="headerlink" href="#upgrading-from-osgearth-2-x-to-osgearth-3-x" title="Permalink to this headline">¶</a></h1>
<p>The goal for osgEarth 3.x was to make the SDK easier to work with for both developers (writing against the API) and end users (creating earth files). This document serves to help you update existing code and earth files for use with osgEarth 3.x.</p>
<p>The primary objectives of 3.x were:</p>
<ul class="simple">
<li>Treat everything as a Layer, so that a Map can be a container for almost all data.</li>
<li>Make all the various Layer types explicit and reduce the dependency on using plug-ins.</li>
<li>Simplify the API for creating and adding Layers by eschewing the “Options” structure pattern.</li>
<li>Simplify the approach to making new or custom Layer types.</li>
</ul>
<div class="section" id="earth-file-changes">
<h2>Earth File Changes<a class="headerlink" href="#earth-file-changes" title="Permalink to this headline">¶</a></h2>
<p>Following the idea of downplaying plugin layer types, Layers in an earth file are now explicit. For a GDAL layer in 2.x you would have had something like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;image</span> <span class="na">name=</span><span class="s">&quot;My Layer&quot;</span> <span class="na">driver=</span><span class="s">&quot;gdal&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;url&gt;</span>file.tif<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/image&gt;</span>
</pre></div>
</div>
<p>In 3.x the layer type is explicit, like so:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;GDALImage</span> <span class="na">name=</span><span class="s">&quot;My Layer&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;url&gt;</span>file.tif<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/GDALImage&gt;</span>
</pre></div>
</div>
<p>Image and Elevation layer types are still separate, and use explicit types are well. A 3.x GDAL elevation layer looks like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;GDALElevation</span> <span class="na">name=</span><span class="s">&quot;My DEM&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;url&gt;</span>dem.tif<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/GDALElevation&gt;</span>
</pre></div>
</div>
<p>Here is a partial table mapping old setups to the new 3.x format:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>2.x</th>
<th>3.x</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;image driver="gdal"&gt;</code></td>
<td><code>&lt;GDALImage&gt;</code></td>
</tr>
<tr>
<td><code>&lt;elevation driver="gdal"&gt;</code></td>
<td><code>&lt;GDALElevation&gt;</code></td>
</tr>
<tr>
<td><code>&lt;image driver="tms"&gt;</code></td>
<td><code>&lt;TMSImage&gt;</code></td>
</tr>
<tr>
<td><code>&lt;elevation driver="tms"&gt;</code></td>
<td><code>&lt;TMSElevation&gt;</code></td>
</tr>
<tr>
<td><code>&lt;image driver="xyz"&gt;</code></td>
<td><code>&lt;XYZImage&gt;</code></td>
</tr>
<tr>
<td><code>&lt;elevation driver="xyz"&gt;</code></td>
<td><code>&lt;XYZElevation&gt;</code></td>
</tr>
<tr>
<td><code>&lt;image driver="wms"&gt;</code></td>
<td><code>&lt;WMSImage&gt;</code></td>
</tr>
</tbody>
</table><div class="section" id="composite-layers">
<h3>Composite layers<a class="headerlink" href="#composite-layers" title="Permalink to this headline">¶</a></h3>
<p>Composite layers in 2.x used the “composite” driver in an image or elevation layer. In 3.x there is a new first-class <code class="docutils literal notranslate"><span class="pre">CompositeImage</span></code> and <code class="docutils literal notranslate"><span class="pre">CompositeElevation</span></code> types. Here is an example:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Map&gt;</span>
    <span class="nt">&lt;CompositeImage</span> <span class="na">name=</span><span class="s">&quot;combined&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;layers&gt;</span>
            <span class="nt">&lt;TMSImage&gt;</span>
                <span class="nt">&lt;url&gt;</span>http://readymap.org/readymap/tiles/1.0.0/7/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;/TMSImage&gt;</span>
            <span class="nt">&lt;GDALImage&gt;</span>
                <span class="nt">&lt;url&gt;</span>locallInset.tif<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;/GDALImage&gt;</span>
        <span class="nt">&lt;/layers&gt;</span>
    <span class="nt">&lt;/CompositeImage&gt;</span>
<span class="nt">&lt;/Map&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="feature-sources">
<h3>Feature sources<a class="headerlink" href="#feature-sources" title="Permalink to this headline">¶</a></h3>
<p>Feature layers (layers containing feature data) are not new to 3.x, but they are also explicit just like the visible layer types above. For example, in osgEarth 2.x you might define a simple feature layer like so:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;feature_model</span> <span class="na">name=</span><span class="s">&quot;states&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;features</span> <span class="na">name=</span><span class="s">&quot;states&quot;</span> <span class="na">driver=</span><span class="s">&quot;ogr&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;url&gt;</span>../data/usa.shp<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/features&gt;</span>        
    <span class="nt">&lt;styles&gt;</span>
        <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
            states {
               stroke: #ffff00;
            }                    
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/styles&gt;</span>        
<span class="nt">&lt;/feature_model&gt;</span>
</pre></div>
</div>
<p>In osgEarth 3.x, the definition (using an embedded feature source) looks like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;FeatureModel</span> <span class="na">name=</span><span class="s">&quot;US States&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;OGRFeatures</span> <span class="na">name=</span><span class="s">&quot;US-Data&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;url&gt;</span>../data/usa.shp<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/OGRFeatures&gt;</span>
    <span class="nt">&lt;styles&gt;</span>
        <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
            states {
               stroke:#ffff00;
            }                    
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/styles&gt;</span>        
<span class="nt">&lt;/FeatureModel&gt;</span>
</pre></div>
</div>
<p>Or, you can define your feature data as a separate Layer and reference it. This way, multiple visible Layers can use the same feature source:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;OGRFeatures</span> <span class="na">name=</span><span class="s">&quot;data:states&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;url&gt;</span>../data/usa.shp<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/OGRFeatures&gt;</span>

<span class="nt">&lt;FeatureModel</span> <span class="na">name=</span><span class="s">&quot;US States&quot;</span> <span class="na">features=</span><span class="s">&quot;data:states&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;styles&gt;</span>
        <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
            states {
               stroke: #ffff00;
            }                    
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/styles&gt;</span>        
<span class="nt">&lt;/FeatureModel&gt;</span>
</pre></div>
</div>
<p>Even a stylesheet can be a separate layer now. You can rewrite the same thing above as:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;OGRFeatures</span> <span class="na">name=</span><span class="s">&quot;data:states&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;url&gt;</span>../data/usa.shp<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/OGRFeatures&gt;</span>

<span class="nt">&lt;Styles</span> <span class="na">name=</span><span class="s">&quot;data:styles&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
        states {
           stroke: #ffff00;
        }                    
    <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/Styles&gt;</span>  

<span class="nt">&lt;FeatureModel</span> <span class="na">name=</span><span class="s">&quot;US States&quot;</span> <span class="na">features=</span><span class="s">&quot;data:states&quot;</span> <span class="na">styles=</span><span class="s">&quot;data:styles&quot;</span><span class="nt">&gt;</span>         
<span class="nt">&lt;/FeatureModel&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="api-changes">
<h2>API Changes<a class="headerlink" href="#api-changes" title="Permalink to this headline">¶</a></h2>
<p>In 2.x, you created map layers (and various other things) by creating an “Options” structure and then passing that to the constructor of the new Layer. In 3.x you no longer need to do that; you can just create a new Layer and call its setter functions.</p>
<p>Here is an example of creating a WMS image layer in osgEarth 2.x:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;osgEarthDrivers/wms/WMSOptions&gt;</span><span class="cp"></span>
<span class="p">...</span>
<span class="n">WMSOptions</span> <span class="n">wms</span><span class="p">;</span>
<span class="n">wms</span><span class="p">.</span><span class="n">url</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi&quot;</span><span class="p">;</span>
<span class="n">wms</span><span class="p">.</span><span class="n">format</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;png&quot;</span><span class="p">;</span>
<span class="n">wms</span><span class="p">.</span><span class="n">layers</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;nexrad-n0r&quot;</span><span class="p">;</span>
<span class="n">wms</span><span class="p">.</span><span class="n">srs</span><span class="p">()</span> <span class="o">=</span> <span class="s">&quot;EPSG:4326&quot;</span><span class="p">;</span>
<span class="n">wms</span><span class="p">.</span><span class="n">transparent</span><span class="p">()</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="n">ImageLayerOptions</span> <span class="nf">wmsLayerOptions</span><span class="p">(</span><span class="s">&quot;WMS NEXRAD&quot;</span><span class="p">,</span> <span class="n">wms</span><span class="p">);</span>
<span class="n">wmsLayerOptions</span><span class="p">.</span><span class="n">cachePolicy</span><span class="p">()</span> <span class="o">=</span> <span class="n">CachePolicy</span><span class="o">::</span><span class="n">NO_CACHE</span><span class="p">;</span>

<span class="n">ImageLayer</span><span class="o">*</span> <span class="n">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ImageLayer</span><span class="p">(</span><span class="n">wmsLayerOptions</span><span class="p">);</span>
<span class="n">map</span><span class="o">-&gt;</span><span class="n">addLayer</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
<p>In 3.x the API is more intuitive, without any intermediate structures:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;osgEarth/WMS&gt;</span><span class="cp"></span>
<span class="p">...</span>
<span class="n">WMSImageLayer</span><span class="o">*</span> <span class="n">wms</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WMSImageLayer</span><span class="p">();</span>
<span class="n">wms</span><span class="o">-&gt;</span><span class="n">setURL</span><span class="p">(</span><span class="s">&quot;http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi&quot;</span><span class="p">);</span>
<span class="n">wms</span><span class="o">-&gt;</span><span class="n">setFormat</span><span class="p">(</span><span class="s">&quot;png&quot;</span><span class="p">);</span>
<span class="n">wms</span><span class="o">-&gt;</span><span class="n">setLayers</span><span class="p">(</span><span class="s">&quot;nexrad-n0r&quot;</span><span class="p">);</span>
<span class="n">wms</span><span class="o">-&gt;</span><span class="n">setSRS</span><span class="p">(</span><span class="s">&quot;EPSG:4326&quot;</span><span class="p">);</span>
<span class="n">wms</span><span class="o">-&gt;</span><span class="n">setTransparent</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="n">wms</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">().</span><span class="n">cachePolicy</span><span class="p">()</span> <span class="o">=</span> <span class="n">CachePolicy</span><span class="o">::</span><span class="n">NO_CACHE</span><span class="p">;</span>
<span class="n">map</span><span class="o">-&gt;</span><span class="n">addLayer</span><span class="p">(</span><span class="n">wms</span><span class="p">);</span>
</pre></div>
</div>
<p>Follow the same pattern for all layer types. See the <code class="docutils literal notranslate"><span class="pre">osgearth_map.cpp</span></code> example for several examples.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="support.html" class="btn btn-neutral float-right" title="Getting Support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="releasenotes.html" class="btn btn-neutral float-left" title="Release Notes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Pelican Mapping
      
        <span class="commit">
          Revision <code>2b0ab5ae</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 3.1
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../latest/index.html">latest</a></dd>
        
          <dd><a href="index.html">3.1</a></dd>
        
          <dd><a href="../2.10/index.html">2.10</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="../../_/downloads/en/3.1/htmlzip/index.html">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/osgearth/?fromdocs=osgearth">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/osgearth/?fromdocs=osgearth">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org/">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>